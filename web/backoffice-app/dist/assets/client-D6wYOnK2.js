import{j as g,N as m}from"./index-CfoPWh9S.js";function k({className:t,...s}){return g.jsx("div",{className:m("animate-pulse rounded-md bg-muted",t),...s})}function w(t){const s={};for(const[n,e]of Object.entries(t))if(!(e==null||e==="")){if(typeof e=="string")s[`filter[${n}]`]=e;else if(typeof e=="object")for(const[o,r]of Object.entries(e))r!=null&&r!==""&&(s[`filter[${n}][${o}]`]=r)}return s}function S(t){const s=new URLSearchParams;for(const[e,o]of Object.entries(t))if(!(o==null||o===""))if(e==="filter"&&typeof o=="object"){const r=w(o);for(const[p,y]of Object.entries(r))s.set(p,y)}else(typeof o=="string"||typeof o=="number"||typeof o=="boolean")&&s.set(e,String(o));const n=s.toString();return n?`?${n}`:""}const d="/api/v1";class f extends Error{constructor(s,n,e,o){super(e),this.status=s,this.code=n,this.details=o,this.name="ApiError"}isValidationError(){return this.code==="VALIDATION_ERROR"}isUnauthorized(){return this.status===401}isForbidden(){return this.status===403}isNotFound(){return this.status===404}}let l=!1,c=null;function a(){const t=localStorage.getItem("forgebase_admin_token");return t?{Authorization:`Bearer ${t}`}:{}}async function j(){var s;const t=localStorage.getItem("forgebase_refresh_token");if(!t)return!1;try{const n=await fetch(`${d}/auth/refresh`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({refreshToken:t})});if(!n.ok)return!1;const e=await n.json();return e.success&&((s=e.data)!=null&&s.tokens)?(localStorage.setItem("forgebase_admin_token",e.data.tokens.accessToken),localStorage.setItem("forgebase_refresh_token",e.data.tokens.refreshToken),!0):!1}catch{return!1}}async function h(){if(l&&c)return c;l=!0,c=j().finally(()=>{l=!1,c=null});const t=await c;return t||(localStorage.removeItem("forgebase_admin_token"),localStorage.removeItem("forgebase_refresh_token"),localStorage.removeItem("forgebase_user"),window.location.pathname.includes("/login")||(window.location.href="/login")),t}async function u(t,s){if(t.status===401&&s&&await h())return s();let n;try{n=await t.json()}catch{throw new f(t.status,"PARSE_ERROR","Failed to parse response")}if(!t.ok||!n.success){const e="error"in n?n.error:void 0;throw new f(t.status,(e==null?void 0:e.code)??"UNKNOWN_ERROR",(e==null?void 0:e.message)??"An error occurred",e==null?void 0:e.details)}return n.data}async function R(t,s){if(t.status===401&&s&&await h())return s();let n;try{n=await t.json()}catch{throw new f(t.status,"PARSE_ERROR","Failed to parse response")}if(!t.ok||!n.success){const e="error"in n?n.error:void 0;throw new f(t.status,(e==null?void 0:e.code)??"UNKNOWN_ERROR",(e==null?void 0:e.message)??"An error occurred",e==null?void 0:e.details)}return n}function i(t,s){const n=s?S(s):"";return`${d}${t}${n}`}const T={async get(t,s){const n=async()=>{const e=await fetch(i(t,s),{method:"GET",headers:{"Content-Type":"application/json",...a()}});return u(e,n)};return n()},async getWithMeta(t,s){const n=async()=>{const e=await fetch(i(t,s),{method:"GET",headers:{"Content-Type":"application/json",...a()}});return R(e,n)};return n()},async post(t,s){const n=async()=>{const e=await fetch(i(t),{method:"POST",headers:{"Content-Type":"application/json",...a()},body:s?JSON.stringify(s):void 0});return u(e,n)};return n()},async patch(t,s){const n=async()=>{const e=await fetch(i(t),{method:"PATCH",headers:{"Content-Type":"application/json",...a()},body:s?JSON.stringify(s):void 0});return u(e,n)};return n()},async put(t,s){const n=async()=>{const e=await fetch(i(t),{method:"PUT",headers:{"Content-Type":"application/json",...a()},body:s?JSON.stringify(s):void 0});return u(e,n)};return n()},async delete(t){const s=async()=>{const n=await fetch(i(t),{method:"DELETE",headers:{"Content-Type":"application/json",...a()}});return u(n,s)};return s()}};export{k as S,T as a};
//# sourceMappingURL=client-D6wYOnK2.js.map
