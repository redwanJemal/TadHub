import{c as ne,r as n,j as e,N as re,w as V,B as x,C as W,A as ce,z as de}from"./index-CfoPWh9S.js";import{I as k,S as M,a as R,b as z,d as $,e as B,C as oe,B as F}from"./badge-BAzsu3vk.js";import{D as me}from"./DataTableAdvanced-tUYlkAy3.js";import{D as H,a as G,b as J,c as K,d as Q,e as X,S as he,T as ue}from"./dialog-C06rURw4.js";import{E as xe}from"./eye-D2jw_eyj.js";import{a as y}from"./client-D6wYOnK2.js";import{P as fe}from"./plus-DWiWKduL.js";/**
 * @license lucide-react v0.460.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const pe=ne("EyeOff",[["path",{d:"M10.733 5.076a10.744 10.744 0 0 1 11.205 6.575 1 1 0 0 1 0 .696 10.747 10.747 0 0 1-1.444 2.49",key:"ct8e1f"}],["path",{d:"M14.084 14.158a3 3 0 0 1-4.242-4.242",key:"151rxh"}],["path",{d:"M17.479 17.499a10.75 10.75 0 0 1-15.417-5.151 1 1 0 0 1 0-.696 10.75 10.75 0 0 1 4.446-5.143",key:"13bj9a"}],["path",{d:"m2 2 20 20",key:"1ooewy"}]]),Y=n.forwardRef(({className:a,...p},S)=>{const[c,l]=n.useState(!1);return e.jsxs("div",{className:"relative",children:[e.jsx(k,{type:c?"text":"password",className:re("pe-10",a),ref:S,...p}),e.jsx("button",{type:"button",onClick:()=>l(!c),className:"absolute end-3 top-1/2 -translate-y-1/2 text-muted-foreground hover:text-foreground transition-colors",tabIndex:-1,"aria-label":c?"Hide password":"Show password",children:c?e.jsx(pe,{className:"h-4 w-4"}):e.jsx(xe,{className:"h-4 w-4"})})]})});Y.displayName="PasswordInput";function ge({open:a,onOpenChange:p,onSuccess:S,user:c}){const{t:l}=V("users"),[d,w]=n.useState(!1),[g,v]=n.useState(null),[j,N]=n.useState([]),[f,E]=n.useState([]),[C,L]=n.useState(!0),[r,m]=n.useState({email:"",password:"",firstName:"",lastName:"",phone:"",tenantId:"",roleId:"",isActive:!0}),h=!!c;n.useEffect(()=>{async function t(){try{const[i,b]=await Promise.all([y.getWithMeta("/admin/tenants"),y.getWithMeta("/admin/roles")]);N(i.data),E(b.data)}catch(i){console.error("Failed to load options:",i)}finally{L(!1)}}a&&t()},[a]),n.useEffect(()=>{var t,i,b,D;if(a&&c){const u=c.tenants[0];m({email:c.email,password:"",firstName:c.firstName,lastName:c.lastName,phone:c.phone||"",tenantId:(u==null?void 0:u.id)||"",roleId:((t=u==null?void 0:u.role)==null?void 0:t.id)||"",isActive:c.isActive})}else a&&m({email:"",password:"",firstName:"",lastName:"",phone:"",tenantId:((i=j[0])==null?void 0:i.id)||"",roleId:((b=f.find(u=>u.slug==="user"))==null?void 0:b.id)||((D=f[0])==null?void 0:D.id)||"",isActive:!0});v(null)},[a,c,j,f]);const O=async t=>{t.preventDefault(),v(null),w(!0);try{if(h)await y.patch(`/admin/users/${c.id}`,{firstName:r.firstName,lastName:r.lastName,phone:r.phone||void 0,isActive:r.isActive,roleId:r.roleId});else{if(!r.password){v(l("errors.passwordRequired")),w(!1);return}await y.post("/admin/users",{email:r.email,password:r.password,firstName:r.firstName,lastName:r.lastName,phone:r.phone||void 0,tenantId:r.tenantId,roleId:r.roleId})}S(),p(!1)}catch(i){v(i instanceof Error?i.message:"An error occurred")}finally{w(!1)}};return e.jsx(H,{open:a,onOpenChange:p,children:e.jsxs(G,{className:"sm:max-w-[500px]",children:[e.jsxs(J,{children:[e.jsx(K,{children:l(h?"editDialog.title":"createDialog.title")}),e.jsx(Q,{children:l(h?"editDialog.description":"createDialog.description")})]}),e.jsxs("form",{onSubmit:O,className:"space-y-4",children:[g&&e.jsx("div",{className:"rounded-md bg-destructive/10 p-3 text-sm text-destructive",children:g}),e.jsxs("div",{className:"grid gap-4 sm:grid-cols-2",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs("label",{htmlFor:"firstName",className:"text-sm font-medium",children:[l("fields.firstName")," *"]}),e.jsx(k,{id:"firstName",value:r.firstName,onChange:t=>m(i=>({...i,firstName:t.target.value})),placeholder:l("fields.firstNamePlaceholder"),required:!0,disabled:d})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("label",{htmlFor:"lastName",className:"text-sm font-medium",children:[l("fields.lastName")," *"]}),e.jsx(k,{id:"lastName",value:r.lastName,onChange:t=>m(i=>({...i,lastName:t.target.value})),placeholder:l("fields.lastNamePlaceholder"),required:!0,disabled:d})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("label",{htmlFor:"email",className:"text-sm font-medium",children:[l("fields.email")," *"]}),e.jsx(k,{id:"email",type:"email",value:r.email,onChange:t=>m(i=>({...i,email:t.target.value})),placeholder:l("fields.emailPlaceholder"),required:!0,disabled:d||h})]}),!h&&e.jsxs("div",{className:"space-y-2",children:[e.jsxs("label",{htmlFor:"password",className:"text-sm font-medium",children:[l("fields.password")," *"]}),e.jsx(Y,{id:"password",value:r.password,onChange:t=>m(i=>({...i,password:t.target.value})),placeholder:l("fields.passwordPlaceholder"),required:!h,disabled:d})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{htmlFor:"phone",className:"text-sm font-medium",children:l("fields.phone")}),e.jsx(k,{id:"phone",value:r.phone,onChange:t=>m(i=>({...i,phone:t.target.value})),placeholder:l("fields.phonePlaceholder"),disabled:d})]}),e.jsxs("div",{className:"grid gap-4 sm:grid-cols-2",children:[!h&&e.jsxs("div",{className:"space-y-2",children:[e.jsxs("label",{htmlFor:"tenant",className:"text-sm font-medium",children:[l("fields.tenant")," *"]}),e.jsxs(M,{value:r.tenantId,onValueChange:t=>m(i=>({...i,tenantId:t})),disabled:d||C,children:[e.jsx(R,{children:e.jsx(z,{placeholder:l("fields.tenantPlaceholder")})}),e.jsx($,{children:j.map(t=>e.jsx(B,{value:t.id,children:t.name},t.id))})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("label",{htmlFor:"role",className:"text-sm font-medium",children:[l("fields.role")," *"]}),e.jsxs(M,{value:r.roleId,onValueChange:t=>m(i=>({...i,roleId:t})),disabled:d||C,children:[e.jsx(R,{children:e.jsx(z,{placeholder:l("fields.rolePlaceholder")})}),e.jsx($,{children:f.map(t=>e.jsx(B,{value:t.id,children:t.name},t.id))})]})]})]}),h&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(oe,{id:"isActive",checked:r.isActive,onCheckedChange:t=>m(i=>({...i,isActive:!!t})),disabled:d}),e.jsx("label",{htmlFor:"isActive",className:"text-sm font-medium cursor-pointer",children:l("fields.isActive")})]}),e.jsxs(X,{children:[e.jsx(x,{type:"button",variant:"outline",onClick:()=>p(!1),disabled:d,children:l("actions.cancel")}),e.jsx(x,{type:"submit",disabled:d||C,children:d?e.jsxs(e.Fragment,{children:[e.jsx(W,{className:"me-2 h-4 w-4 animate-spin"}),l(h?"actions.saving":"actions.creating")]}):l(h?"actions.save":"actions.create")})]})]})]})})}function Ce(){const{t:a}=V("users"),[p,S]=n.useState([]),[c,l]=n.useState(!0),[d,w]=n.useState(""),[g,v]=n.useState(),[j,N]=n.useState(1),[f,E]=n.useState(20),[C,L]=n.useState(0),[r,m]=n.useState(1),[h,O]=n.useState([]),[t,i]=n.useState(!1),[b,D]=n.useState(null),[u,A]=n.useState(!1),[I,U]=n.useState(null),[T,q]=n.useState(!1),P=n.useCallback(async()=>{l(!0);try{const s={page:String(j),perPage:String(f)};d&&(s.q=d),g&&(s.status=g);const o=await y.getWithMeta("/admin/users",s);S(o.data),o.meta&&(L(o.meta.total??0),m(o.meta.totalPages??1))}catch(s){console.error("Failed to fetch users:",s)}finally{l(!1)}},[j,f,d,g]);n.useEffect(()=>{P()},[P]),n.useEffect(()=>{const s=setTimeout(()=>{N(1)},300);return()=>clearTimeout(s)},[d]);const Z=s=>{D(s),i(!0)},_=()=>{D(null),i(!0)},ee=s=>{U(s),A(!0)},se=async()=>{if(I){q(!0);try{await y.delete(`/admin/users/${I.id}`),P(),A(!1),U(null)}catch(s){console.error("Failed to delete user:",s)}finally{q(!1)}}},ae=(s,o)=>`${s[0]||""}${o[0]||""}`.toUpperCase(),te=[{key:"name",header:a("columns.name"),cell:s=>e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(ce,{className:"h-8 w-8",children:e.jsx(de,{className:"bg-primary/10 text-primary text-xs",children:ae(s.firstName,s.lastName)})}),e.jsxs("div",{children:[e.jsxs("p",{className:"font-medium",children:[s.firstName," ",s.lastName]}),e.jsx("p",{className:"text-xs text-muted-foreground",children:s.email})]})]})},{key:"tenants",header:a("columns.tenant"),cell:s=>e.jsxs("div",{className:"flex flex-wrap gap-1",children:[s.tenants.length>0?s.tenants.slice(0,2).map(o=>e.jsx(F,{variant:"outline",className:"text-xs",children:o.name},o.id)):e.jsx("span",{className:"text-muted-foreground",children:"-"}),s.tenants.length>2&&e.jsxs(F,{variant:"secondary",className:"text-xs",children:["+",s.tenants.length-2]})]})},{key:"role",header:a("columns.role"),cell:s=>{const o=s.tenants[0];return o?e.jsx(F,{variant:o.role.slug==="super-admin"?"default":"secondary",children:o.role.name}):"-"}},{key:"isActive",header:a("columns.status"),cell:s=>e.jsx(F,{variant:s.isActive?"success":"secondary",children:s.isActive?a("status.active"):a("status.inactive")})},{key:"lastLoginAt",header:a("columns.lastLogin"),cell:s=>s.lastLoginAt?new Date(s.lastLoginAt).toLocaleDateString():a("neverLoggedIn")},{key:"actions",header:a("columns.actions"),cell:s=>e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(x,{variant:"ghost",size:"icon",className:"h-8 w-8",onClick:()=>Z(s),children:e.jsx(he,{className:"h-4 w-4"})}),e.jsx(x,{variant:"ghost",size:"icon",className:"h-8 w-8 text-destructive",onClick:()=>ee(s),children:e.jsx(ue,{className:"h-4 w-4"})})]}),className:"w-[80px]"}],le=[{key:"status",label:a("filters.status"),value:g,options:[{label:a("status.active"),value:"active"},{label:a("status.inactive"),value:"inactive"}]}],ie=(s,o)=>{s==="status"&&(v(o),N(1))};return e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"flex flex-col gap-4 sm:flex-row sm:items-center sm:justify-between",children:e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold md:text-3xl",children:a("title")}),e.jsx("p",{className:"text-muted-foreground",children:a("subtitle")})]})}),e.jsx(me,{columns:te,data:p,isLoading:c,searchValue:d,onSearchChange:w,searchPlaceholder:a("searchPlaceholder"),filters:le,onFilterChange:ie,page:j,totalPages:r,total:C,perPage:f,onPageChange:N,onPerPageChange:s=>{E(s),N(1)},selectable:!0,selectedIds:h,onSelectionChange:O,onRefresh:P,actions:e.jsxs(x,{onClick:_,children:[e.jsx(fe,{className:"h-4 w-4"}),e.jsx("span",{className:"hidden sm:inline ms-2",children:a("addUser")})]}),bulkActions:e.jsxs(e.Fragment,{children:[e.jsx(x,{variant:"outline",size:"sm",children:a("bulkActions.activate")}),e.jsx(x,{variant:"outline",size:"sm",children:a("bulkActions.deactivate")}),e.jsx(x,{variant:"destructive",size:"sm",children:a("bulkActions.delete")})]})}),e.jsx(ge,{open:t,onOpenChange:i,onSuccess:P,user:b}),e.jsx(H,{open:u,onOpenChange:A,children:e.jsxs(G,{children:[e.jsxs(J,{children:[e.jsx(K,{children:a("deleteDialog.title")}),e.jsx(Q,{children:a("deleteDialog.description",{name:I?`${I.firstName} ${I.lastName}`:""})})]}),e.jsxs(X,{children:[e.jsx(x,{variant:"outline",onClick:()=>A(!1),disabled:T,children:a("actions.cancel")}),e.jsx(x,{variant:"destructive",onClick:se,disabled:T,children:T?e.jsxs(e.Fragment,{children:[e.jsx(W,{className:"me-2 h-4 w-4 animate-spin"}),a("actions.deleting")]}):a("actions.delete")})]})]})})]})}export{Ce as UsersPage};
//# sourceMappingURL=UsersPage-B1jpV2Jw.js.map
