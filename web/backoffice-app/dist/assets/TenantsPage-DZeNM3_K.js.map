{"version":3,"file":"TenantsPage-DZeNM3_K.js","sources":["../../src/features/tenants/TenantsPage.tsx"],"sourcesContent":["import { useState, useEffect, useCallback } from \"react\";\nimport { useTranslation } from \"react-i18next\";\nimport { useNavigate } from \"react-router-dom\";\nimport { DataTableAdvanced, type Column, type Filter } from \"@/shared/components/data-table\";\nimport { Button } from \"@/shared/components/ui/button\";\nimport { Badge } from \"@/shared/components/ui/badge\";\nimport {\n  Dialog,\n  DialogContent,\n  DialogDescription,\n  DialogFooter,\n  DialogHeader,\n  DialogTitle,\n} from \"@/shared/components/ui/dialog\";\nimport { Plus, Eye, Edit, Trash2, Building2, Loader2 } from \"lucide-react\";\nimport { TenantSheet } from \"./components/TenantSheet\";\nimport { apiClient } from \"@/shared/api\";\n\ninterface Tenant {\n  id: string;\n  name: string;\n  slug: string;\n  domain?: string;\n  plan?: {\n    id: string;\n    name: string;\n    slug: string;\n  };\n  usersCount: number;\n  isActive: boolean;\n  settings?: {\n    maxUsers?: number;\n    allowRegistration?: boolean;\n    enableApi?: boolean;\n  };\n  createdAt: string;\n}\n\nexport function TenantsPage() {\n  const { t } = useTranslation(\"tenants\");\n  const navigate = useNavigate();\n\n  // State\n  const [data, setData] = useState<Tenant[]>([]);\n  const [isLoading, setIsLoading] = useState(true);\n  const [search, setSearch] = useState(\"\");\n  const [statusFilter, setStatusFilter] = useState<string | undefined>();\n  const [page, setPage] = useState(1);\n  const [perPage, setPerPage] = useState(20);\n  const [total, setTotal] = useState(0);\n  const [totalPages, setTotalPages] = useState(1);\n  const [selectedIds, setSelectedIds] = useState<string[]>([]);\n\n  // Sheet/Dialog states\n  const [sheetOpen, setSheetOpen] = useState(false);\n  const [editingTenant, setEditingTenant] = useState<Tenant | null>(null);\n  const [deleteDialogOpen, setDeleteDialogOpen] = useState(false);\n  const [deletingTenant, setDeletingTenant] = useState<Tenant | null>(null);\n  const [isDeleting, setIsDeleting] = useState(false);\n\n  // Fetch data\n  const fetchTenants = useCallback(async () => {\n    setIsLoading(true);\n    try {\n      const params: Record<string, string> = {\n        page: String(page),\n        perPage: String(perPage),\n      };\n      if (search) params.q = search;\n      if (statusFilter) params.status = statusFilter;\n\n      const response = await apiClient.getWithMeta<Tenant[]>(\"/admin/tenants\", params);\n      setData(response.data);\n      if (response.meta) {\n        setTotal(response.meta.total ?? 0);\n        setTotalPages(response.meta.totalPages ?? 1);\n      }\n    } catch (error) {\n      console.error(\"Failed to fetch tenants:\", error);\n    } finally {\n      setIsLoading(false);\n    }\n  }, [page, perPage, search, statusFilter]);\n\n  useEffect(() => {\n    fetchTenants();\n  }, [fetchTenants]);\n\n  // Debounced search\n  useEffect(() => {\n    const timer = setTimeout(() => {\n      setPage(1);\n    }, 300);\n    return () => clearTimeout(timer);\n  }, [search]);\n\n  // Handlers\n  const handleView = (tenant: Tenant) => {\n    navigate(`/tenants/${tenant.id}`);\n  };\n\n  const handleEdit = (tenant: Tenant) => {\n    setEditingTenant(tenant);\n    setSheetOpen(true);\n  };\n\n  const handleCreate = () => {\n    setEditingTenant(null);\n    setSheetOpen(true);\n  };\n\n  const handleDeleteClick = (tenant: Tenant) => {\n    setDeletingTenant(tenant);\n    setDeleteDialogOpen(true);\n  };\n\n  const handleDeleteConfirm = async () => {\n    if (!deletingTenant) return;\n    setIsDeleting(true);\n    try {\n      await apiClient.delete(`/admin/tenants/${deletingTenant.id}`);\n      fetchTenants();\n      setDeleteDialogOpen(false);\n      setDeletingTenant(null);\n    } catch (error) {\n      console.error(\"Failed to delete tenant:\", error);\n    } finally {\n      setIsDeleting(false);\n    }\n  };\n\n  // Columns\n  const columns: Column<Tenant>[] = [\n    {\n      key: \"name\",\n      header: t(\"columns.name\"),\n      cell: (row) => (\n        <div className=\"flex items-center gap-3\">\n          <div className=\"flex h-9 w-9 items-center justify-center rounded-lg bg-primary/10\">\n            <Building2 className=\"h-4 w-4 text-primary\" />\n          </div>\n          <div>\n            <button\n              onClick={() => handleView(row)}\n              className=\"font-medium hover:text-primary hover:underline text-left\"\n            >\n              {row.name}\n            </button>\n            <p className=\"text-xs text-muted-foreground\">{row.slug}</p>\n          </div>\n        </div>\n      ),\n    },\n    {\n      key: \"domain\",\n      header: t(\"columns.domain\"),\n      cell: (row) => row.domain || \"-\",\n    },\n    {\n      key: \"plan\",\n      header: t(\"columns.plan\"),\n      cell: (row) => (\n        <Badge variant={row.plan ? \"default\" : \"outline\"}>\n          {row.plan?.name || t(\"noPlan\")}\n        </Badge>\n      ),\n    },\n    {\n      key: \"usersCount\",\n      header: t(\"columns.users\"),\n      cell: (row) => row.usersCount,\n      className: \"text-center\",\n    },\n    {\n      key: \"isActive\",\n      header: t(\"columns.status\"),\n      cell: (row) => (\n        <Badge variant={row.isActive ? \"success\" : \"secondary\"}>\n          {row.isActive ? t(\"status.active\") : t(\"status.inactive\")}\n        </Badge>\n      ),\n    },\n    {\n      key: \"createdAt\",\n      header: t(\"columns.createdAt\"),\n      cell: (row) => new Date(row.createdAt).toLocaleDateString(),\n    },\n    {\n      key: \"actions\",\n      header: t(\"columns.actions\"),\n      cell: (row) => (\n        <div className=\"flex items-center gap-1\">\n          <Button\n            variant=\"ghost\"\n            size=\"icon\"\n            className=\"h-8 w-8\"\n            onClick={() => handleView(row)}\n            title={t(\"actions.view\")}\n          >\n            <Eye className=\"h-4 w-4\" />\n          </Button>\n          <Button\n            variant=\"ghost\"\n            size=\"icon\"\n            className=\"h-8 w-8\"\n            onClick={() => handleEdit(row)}\n            title={t(\"actions.edit\")}\n          >\n            <Edit className=\"h-4 w-4\" />\n          </Button>\n          <Button\n            variant=\"ghost\"\n            size=\"icon\"\n            className=\"h-8 w-8 text-destructive\"\n            onClick={() => handleDeleteClick(row)}\n            title={t(\"actions.delete\")}\n          >\n            <Trash2 className=\"h-4 w-4\" />\n          </Button>\n        </div>\n      ),\n      className: \"w-[100px]\",\n    },\n  ];\n\n  // Filters\n  const filters: Filter[] = [\n    {\n      key: \"status\",\n      label: t(\"filters.status\"),\n      value: statusFilter,\n      options: [\n        { label: t(\"status.active\"), value: \"active\" },\n        { label: t(\"status.inactive\"), value: \"inactive\" },\n      ],\n    },\n  ];\n\n  const handleFilterChange = (key: string, value: string | undefined) => {\n    if (key === \"status\") {\n      setStatusFilter(value);\n      setPage(1);\n    }\n  };\n\n  return (\n    <div className=\"space-y-6\">\n      {/* Page header */}\n      <div className=\"flex flex-col gap-4 sm:flex-row sm:items-center sm:justify-between\">\n        <div>\n          <h1 className=\"text-2xl font-bold md:text-3xl\">{t(\"title\")}</h1>\n          <p className=\"text-muted-foreground\">{t(\"subtitle\")}</p>\n        </div>\n      </div>\n\n      {/* Data table */}\n      <DataTableAdvanced\n        columns={columns}\n        data={data}\n        isLoading={isLoading}\n        // Search\n        searchValue={search}\n        onSearchChange={setSearch}\n        searchPlaceholder={t(\"searchPlaceholder\")}\n        // Filters\n        filters={filters}\n        onFilterChange={handleFilterChange}\n        // Pagination\n        page={page}\n        totalPages={totalPages}\n        total={total}\n        perPage={perPage}\n        onPageChange={setPage}\n        onPerPageChange={(newPerPage) => {\n          setPerPage(newPerPage);\n          setPage(1);\n        }}\n        // Selection\n        selectable\n        selectedIds={selectedIds}\n        onSelectionChange={setSelectedIds}\n        // Actions\n        onRefresh={fetchTenants}\n        actions={\n          <Button onClick={handleCreate}>\n            <Plus className=\"h-4 w-4\" />\n            <span className=\"hidden sm:inline ms-2\">{t(\"addTenant\")}</span>\n          </Button>\n        }\n      />\n\n      {/* Side Sheet for Add/Edit */}\n      <TenantSheet\n        open={sheetOpen}\n        onOpenChange={setSheetOpen}\n        onSuccess={fetchTenants}\n        tenant={editingTenant}\n      />\n\n      {/* Delete Confirmation Dialog */}\n      <Dialog open={deleteDialogOpen} onOpenChange={setDeleteDialogOpen}>\n        <DialogContent>\n          <DialogHeader>\n            <DialogTitle>{t(\"deleteDialog.title\")}</DialogTitle>\n            <DialogDescription>\n              {t(\"deleteDialog.description\", { name: deletingTenant?.name })}\n            </DialogDescription>\n          </DialogHeader>\n          <DialogFooter>\n            <Button\n              variant=\"outline\"\n              onClick={() => setDeleteDialogOpen(false)}\n              disabled={isDeleting}\n            >\n              {t(\"actions.cancel\")}\n            </Button>\n            <Button\n              variant=\"destructive\"\n              onClick={handleDeleteConfirm}\n              disabled={isDeleting}\n            >\n              {isDeleting ? (\n                <>\n                  <Loader2 className=\"me-2 h-4 w-4 animate-spin\" />\n                  {t(\"actions.deleting\")}\n                </>\n              ) : (\n                t(\"actions.delete\")\n              )}\n            </Button>\n          </DialogFooter>\n        </DialogContent>\n      </Dialog>\n    </div>\n  );\n}\n"],"names":["TenantsPage","t","useTranslation","navigate","useNavigate","data","setData","useState","isLoading","setIsLoading","search","setSearch","statusFilter","setStatusFilter","page","setPage","perPage","setPerPage","total","setTotal","totalPages","setTotalPages","selectedIds","setSelectedIds","sheetOpen","setSheetOpen","editingTenant","setEditingTenant","deleteDialogOpen","setDeleteDialogOpen","deletingTenant","setDeletingTenant","isDeleting","setIsDeleting","fetchTenants","useCallback","params","response","apiClient","error","useEffect","timer","handleView","tenant","handleEdit","handleCreate","handleDeleteClick","handleDeleteConfirm","columns","row","jsxs","jsx","Building2","Badge","_a","Button","Eye","Edit","Trash2","filters","handleFilterChange","key","value","DataTableAdvanced","newPerPage","Plus","TenantSheet","Dialog","DialogContent","DialogHeader","DialogTitle","DialogDescription","DialogFooter","Fragment","Loader2"],"mappings":"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"}