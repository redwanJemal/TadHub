import{w as q,r as n,j as e,C as A,B as f,S as X}from"./index-CfoPWh9S.js";import{I as L,C as O,B}from"./badge-BAzsu3vk.js";import{D as Y}from"./DataTableAdvanced-tUYlkAy3.js";import{D as z,a as M,b as $,c as H,d as V,e as W,S as Z,T as _}from"./dialog-C06rURw4.js";import{a as v}from"./client-D6wYOnK2.js";import{P as ee}from"./plus-DWiWKduL.js";function se({open:l,onOpenChange:N,onSuccess:I,role:i}){const{t:c}=q("roles"),[o,C]=n.useState(!1),[j,p]=n.useState(null),[y,w]=n.useState([]),[k,F]=n.useState(!0),[d,x]=n.useState({name:"",slug:"",description:"",permissionIds:[]}),u=!!i;n.useEffect(()=>{async function s(){try{const t=await v.get("/admin/permissions");w(t)}catch(t){console.error("Failed to load permissions:",t)}finally{F(!1)}}l&&s()},[l]),n.useEffect(()=>{l&&i?x({name:i.name,slug:i.slug,description:i.description||"",permissionIds:i.permissions.map(s=>s.id)}):l&&x({name:"",slug:"",description:"",permissionIds:[]}),p(null)},[l,i]);const E=async s=>{s.preventDefault(),p(null),C(!0);try{u&&i?await v.patch(`/admin/roles/${i.id}`,{name:d.name,description:d.description||void 0,permissionIds:d.permissionIds}):await v.post("/admin/roles",{name:d.name,slug:d.slug,description:d.description||void 0,permissionIds:d.permissionIds}),I(),N(!1)}catch(t){p(t instanceof Error?t.message:"An error occurred")}finally{C(!1)}},D=s=>s.toLowerCase().replace(/[^a-z0-9]+/g,"-").replace(/^-|-$/g,""),S=s=>{x(t=>({...t,name:s,slug:!u&&t.slug===D(t.name)?D(s):t.slug}))},R=s=>{x(t=>({...t,permissionIds:t.permissionIds.includes(s)?t.permissionIds.filter(h=>h!==s):[...t.permissionIds,s]}))},b=s=>{const h=y.filter(m=>m.module===s).map(m=>m.id),g=h.every(m=>d.permissionIds.includes(m));x(m=>({...m,permissionIds:g?m.permissionIds.filter(r=>!h.includes(r)):[...new Set([...m.permissionIds,...h])]}))},T=y.reduce((s,t)=>{const h=s[t.module]??[];return s[t.module]=[...h,t],s},{});return e.jsx(z,{open:l,onOpenChange:N,children:e.jsxs(M,{className:"sm:max-w-[600px] max-h-[85vh] overflow-y-auto",children:[e.jsxs($,{children:[e.jsx(H,{children:c(u?"editDialog.title":"createDialog.title")}),e.jsx(V,{children:c(u?"editDialog.description":"createDialog.description")})]}),e.jsxs("form",{onSubmit:E,className:"space-y-6",children:[j&&e.jsx("div",{className:"rounded-md bg-destructive/10 p-3 text-sm text-destructive",children:j}),e.jsxs("div",{className:"grid gap-4 sm:grid-cols-2",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs("label",{htmlFor:"name",className:"text-sm font-medium",children:[c("fields.name")," *"]}),e.jsx(L,{id:"name",value:d.name,onChange:s=>S(s.target.value),placeholder:c("fields.namePlaceholder"),required:!0,disabled:o||u&&(i==null?void 0:i.isSystem)})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("label",{htmlFor:"slug",className:"text-sm font-medium",children:[c("fields.slug")," *"]}),e.jsx(L,{id:"slug",value:d.slug,onChange:s=>x(t=>({...t,slug:s.target.value})),placeholder:c("fields.slugPlaceholder"),required:!0,disabled:o||u})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{htmlFor:"description",className:"text-sm font-medium",children:c("fields.description")}),e.jsx(L,{id:"description",value:d.description,onChange:s=>x(t=>({...t,description:s.target.value})),placeholder:c("fields.descriptionPlaceholder"),disabled:o})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("label",{className:"text-sm font-medium",children:c("fields.permissions")}),k?e.jsx("div",{className:"flex items-center justify-center py-8",children:e.jsx(A,{className:"h-6 w-6 animate-spin text-muted-foreground"})}):e.jsx("div",{className:"space-y-4 rounded-lg border p-4",children:Object.entries(T).map(([s,t])=>{const h=t.map(r=>r.id),g=h.every(r=>d.permissionIds.includes(r)),m=h.some(r=>d.permissionIds.includes(r))&&!g;return e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(O,{checked:g,indeterminate:m,onCheckedChange:()=>b(s),disabled:o||u&&(i==null?void 0:i.isSystem)}),e.jsx("span",{className:"font-medium capitalize",children:s}),e.jsx(B,{variant:"secondary",className:"text-xs",children:t.length})]}),e.jsx("div",{className:"ms-6 grid gap-2 sm:grid-cols-2",children:t.map(r=>e.jsxs("label",{className:"flex items-center gap-2 text-sm cursor-pointer",children:[e.jsx(O,{checked:d.permissionIds.includes(r.id),onCheckedChange:()=>R(r.id),disabled:o||u&&(i==null?void 0:i.isSystem)}),e.jsx("span",{className:"text-muted-foreground",children:r.action})]},r.id))})]},s)})})]}),e.jsxs(W,{children:[e.jsx(f,{type:"button",variant:"outline",onClick:()=>N(!1),disabled:o,children:c("actions.cancel")}),e.jsx(f,{type:"submit",disabled:o||u&&(i==null?void 0:i.isSystem),children:o?e.jsxs(e.Fragment,{children:[e.jsx(A,{className:"me-2 h-4 w-4 animate-spin"}),c(u?"actions.saving":"actions.creating")]}):c(u?"actions.save":"actions.create")})]})]})]})})}function re(){const{t:l}=q("roles"),[N,I]=n.useState([]),[i,c]=n.useState(!0),[o,C]=n.useState(""),[j,p]=n.useState(1),[y,w]=n.useState(20),[k,F]=n.useState(0),[d,x]=n.useState(1),[u,E]=n.useState([]),[D,S]=n.useState(!1),[R,b]=n.useState(null),[T,s]=n.useState(!1),[t,h]=n.useState(null),[g,m]=n.useState(!1),r=n.useCallback(async()=>{c(!0);try{const a={page:String(j),perPage:String(y)};o&&(a.q=o);const P=await v.getWithMeta("/admin/roles",a);I(P.data),P.meta&&(F(P.meta.total??0),x(P.meta.totalPages??1))}catch(a){console.error("Failed to fetch roles:",a)}finally{c(!1)}},[j,y,o]);n.useEffect(()=>{r()},[r]),n.useEffect(()=>{const a=setTimeout(()=>{p(1)},300);return()=>clearTimeout(a)},[o]);const G=a=>{b(a),S(!0)},J=()=>{b(null),S(!0)},K=a=>{h(a),s(!0)},Q=async()=>{if(t){m(!0);try{await v.delete(`/admin/roles/${t.id}`),r(),s(!1),h(null)}catch(a){console.error("Failed to delete role:",a)}finally{m(!1)}}},U=[{key:"name",header:l("columns.name"),cell:a=>e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"flex h-9 w-9 items-center justify-center rounded-lg bg-primary/10",children:e.jsx(X,{className:"h-4 w-4 text-primary"})}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("p",{className:"font-medium",children:a.name}),a.isSystem&&e.jsx(B,{variant:"outline",className:"text-xs",children:l("systemRole")})]}),e.jsx("p",{className:"text-xs text-muted-foreground",children:a.description||a.slug})]})]})},{key:"permissionsCount",header:l("columns.permissions"),className:"text-center",cell:a=>e.jsx(B,{variant:"secondary",children:a.permissionsCount})},{key:"usersCount",header:l("columns.users"),className:"text-center",cell:a=>a.usersCount},{key:"createdAt",header:l("columns.createdAt"),cell:a=>new Date(a.createdAt).toLocaleDateString()},{key:"actions",header:l("columns.actions"),cell:a=>e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(f,{variant:"ghost",size:"icon",className:"h-8 w-8",onClick:()=>G(a),children:e.jsx(Z,{className:"h-4 w-4"})}),!a.isSystem&&e.jsx(f,{variant:"ghost",size:"icon",className:"h-8 w-8 text-destructive",onClick:()=>K(a),children:e.jsx(_,{className:"h-4 w-4"})})]}),className:"w-[80px]"}];return e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"flex flex-col gap-4 sm:flex-row sm:items-center sm:justify-between",children:e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold md:text-3xl",children:l("title")}),e.jsx("p",{className:"text-muted-foreground",children:l("subtitle")})]})}),e.jsx(Y,{columns:U,data:N,isLoading:i,searchValue:o,onSearchChange:C,searchPlaceholder:l("searchPlaceholder"),page:j,totalPages:d,total:k,perPage:y,onPageChange:p,onPerPageChange:a=>{w(a),p(1)},selectable:!0,selectedIds:u,onSelectionChange:E,onRefresh:r,actions:e.jsxs(f,{onClick:J,children:[e.jsx(ee,{className:"h-4 w-4"}),e.jsx("span",{className:"hidden sm:inline ms-2",children:l("addRole")})]})}),e.jsx(se,{open:D,onOpenChange:S,onSuccess:r,role:R}),e.jsx(z,{open:T,onOpenChange:s,children:e.jsxs(M,{children:[e.jsxs($,{children:[e.jsx(H,{children:l("deleteDialog.title")}),e.jsx(V,{children:l("deleteDialog.description",{name:t==null?void 0:t.name})})]}),e.jsxs(W,{children:[e.jsx(f,{variant:"outline",onClick:()=>s(!1),disabled:g,children:l("actions.cancel")}),e.jsx(f,{variant:"destructive",onClick:Q,disabled:g,children:g?e.jsxs(e.Fragment,{children:[e.jsx(A,{className:"me-2 h-4 w-4 animate-spin"}),l("actions.deleting")]}):l("actions.delete")})]})]})})]})}export{re as RolesPage};
//# sourceMappingURL=RolesPage-C0xRYWOE.js.map
