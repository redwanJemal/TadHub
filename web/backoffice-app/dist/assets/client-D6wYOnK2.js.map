{"version":3,"file":"client-D6wYOnK2.js","sources":["../../src/shared/components/ui/skeleton.tsx","../../src/shared/api/types/common.ts","../../src/shared/api/client.ts"],"sourcesContent":["import { cn } from \"@/shared/lib/cn\";\n\nfunction Skeleton({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) {\n  return (\n    <div\n      className={cn(\"animate-pulse rounded-md bg-muted\", className)}\n      {...props}\n    />\n  );\n}\n\nexport { Skeleton };\n","/**\n * Standard API response meta with pagination info\n */\nexport interface ResponseMeta {\n  requestId: string;\n  timestamp: string;\n  page?: number;\n  perPage?: number;\n  total?: number;\n  totalPages?: number;\n  hasNext?: boolean;\n  hasPrev?: boolean;\n}\n\n/**\n * Error details for validation errors\n */\nexport interface ValidationError {\n  field: string;\n  message: string;\n  constraint?: string;\n}\n\n/**\n * Standard API error response\n */\nexport interface ApiErrorResponse {\n  success: false;\n  error: {\n    code: string;\n    message: string;\n    details?: ValidationError[];\n  };\n  meta: ResponseMeta;\n}\n\n/**\n * Standard API success response\n */\nexport interface ApiSuccessResponse<T> {\n  success: true;\n  data: T;\n  meta: ResponseMeta;\n}\n\n/**\n * Union type for all API responses\n */\nexport type ApiResponse<T> = ApiSuccessResponse<T> | ApiErrorResponse;\n\n/**\n * Paginated response data\n */\nexport interface PaginatedData<T> {\n  items: T[];\n  total: number;\n  page: number;\n  perPage: number;\n  totalPages: number;\n}\n\n/**\n * Query parameters for list endpoints\n */\nexport interface QueryParams {\n  page?: number;\n  perPage?: number;\n  sort?: string;\n  order?: 'asc' | 'desc';\n  q?: string;\n  include?: string;\n  fields?: string;\n  filter?: Record<string, string | Record<string, string>>;\n  [key: string]: unknown;\n}\n\n/**\n * Filter operators\n */\nexport type FilterOperator = 'eq' | 'ne' | 'gt' | 'gte' | 'lt' | 'lte' | 'in' | 'nin' | 'like' | 'null';\n\n/**\n * Build filter query string\n * @example buildFilterParams({ status: 'active', age: { gte: '18' } })\n * // => { 'filter[status]': 'active', 'filter[age][gte]': '18' }\n */\nexport function buildFilterParams(\n  filters: Record<string, string | Record<string, string>>\n): Record<string, string> {\n  const result: Record<string, string> = {};\n\n  for (const [field, value] of Object.entries(filters)) {\n    if (value === undefined || value === null || value === '') continue;\n\n    if (typeof value === 'string') {\n      result[`filter[${field}]`] = value;\n    } else if (typeof value === 'object') {\n      for (const [op, opValue] of Object.entries(value)) {\n        if (opValue !== undefined && opValue !== null && opValue !== '') {\n          result[`filter[${field}][${op}]`] = opValue;\n        }\n      }\n    }\n  }\n\n  return result;\n}\n\n/**\n * Build query string from params\n */\nexport function buildQueryString(params: QueryParams): string {\n  const searchParams = new URLSearchParams();\n\n  for (const [key, value] of Object.entries(params)) {\n    if (value === undefined || value === null || value === '') continue;\n\n    if (key === 'filter' && typeof value === 'object') {\n      const filterParams = buildFilterParams(value as Record<string, string | Record<string, string>>);\n      for (const [filterKey, filterValue] of Object.entries(filterParams)) {\n        searchParams.set(filterKey, filterValue);\n      }\n    } else if (typeof value === 'string' || typeof value === 'number' || typeof value === 'boolean') {\n      searchParams.set(key, String(value));\n    }\n  }\n\n  const queryString = searchParams.toString();\n  return queryString ? `?${queryString}` : '';\n}\n","import { ApiResponse, ApiSuccessResponse, QueryParams, buildQueryString } from './types';\n\nconst API_BASE = '/api/v1';\n\n/**\n * Custom API Error class with status code and error details\n */\nexport class ApiError extends Error {\n  constructor(\n    public status: number,\n    public code: string,\n    message: string,\n    public details?: unknown\n  ) {\n    super(message);\n    this.name = 'ApiError';\n  }\n\n  isValidationError(): boolean {\n    return this.code === 'VALIDATION_ERROR';\n  }\n\n  isUnauthorized(): boolean {\n    return this.status === 401;\n  }\n\n  isForbidden(): boolean {\n    return this.status === 403;\n  }\n\n  isNotFound(): boolean {\n    return this.status === 404;\n  }\n}\n\n// Track if we're currently refreshing to prevent multiple refresh calls\nlet isRefreshing = false;\nlet refreshPromise: Promise<boolean> | null = null;\n\n/**\n * Get authentication headers from storage\n */\nfunction getAuthHeaders(): HeadersInit {\n  const token = localStorage.getItem('forgebase_admin_token');\n  return token ? { Authorization: `Bearer ${token}` } : {};\n}\n\n/**\n * Attempt to refresh the access token\n */\nasync function refreshAccessToken(): Promise<boolean> {\n  const refreshToken = localStorage.getItem('forgebase_refresh_token');\n  if (!refreshToken) return false;\n\n  try {\n    const response = await fetch(`${API_BASE}/auth/refresh`, {\n      method: 'POST',\n      headers: { 'Content-Type': 'application/json' },\n      body: JSON.stringify({ refreshToken }),\n    });\n\n    if (!response.ok) return false;\n\n    const json = await response.json();\n    if (json.success && json.data?.tokens) {\n      localStorage.setItem('forgebase_admin_token', json.data.tokens.accessToken);\n      localStorage.setItem('forgebase_refresh_token', json.data.tokens.refreshToken);\n      return true;\n    }\n    return false;\n  } catch {\n    return false;\n  }\n}\n\n/**\n * Handle 401 - attempt refresh or redirect to login\n */\nasync function handleUnauthorized(): Promise<boolean> {\n  // If already refreshing, wait for that to complete\n  if (isRefreshing && refreshPromise) {\n    return refreshPromise;\n  }\n\n  isRefreshing = true;\n  refreshPromise = refreshAccessToken().finally(() => {\n    isRefreshing = false;\n    refreshPromise = null;\n  });\n\n  const success = await refreshPromise;\n  \n  if (!success) {\n    // Clear tokens and redirect to login\n    localStorage.removeItem('forgebase_admin_token');\n    localStorage.removeItem('forgebase_refresh_token');\n    localStorage.removeItem('forgebase_user');\n    \n    // Only redirect if not already on login page\n    if (!window.location.pathname.includes('/login')) {\n      window.location.href = '/login';\n    }\n  }\n  \n  return success;\n}\n\n/**\n * Handle API response and throw on error\n */\nasync function handleResponse<T>(response: Response, retryFn?: () => Promise<T>): Promise<T> {\n  // Handle 401 - try refresh\n  if (response.status === 401 && retryFn) {\n    const refreshed = await handleUnauthorized();\n    if (refreshed) {\n      return retryFn();\n    }\n  }\n\n  let json: ApiResponse<T>;\n\n  try {\n    json = await response.json();\n  } catch {\n    throw new ApiError(\n      response.status,\n      'PARSE_ERROR',\n      'Failed to parse response'\n    );\n  }\n\n  if (!response.ok || !json.success) {\n    const error = 'error' in json ? json.error : undefined;\n    throw new ApiError(\n      response.status,\n      error?.code ?? 'UNKNOWN_ERROR',\n      error?.message ?? 'An error occurred',\n      error?.details\n    );\n  }\n\n  return json.data as T;\n}\n\n/**\n * Handle API response and return full response with meta\n */\nasync function handleResponseWithMeta<T>(response: Response, retryFn?: () => Promise<ApiSuccessResponse<T>>): Promise<ApiSuccessResponse<T>> {\n  // Handle 401 - try refresh\n  if (response.status === 401 && retryFn) {\n    const refreshed = await handleUnauthorized();\n    if (refreshed) {\n      return retryFn();\n    }\n  }\n\n  let json: ApiResponse<T>;\n\n  try {\n    json = await response.json();\n  } catch {\n    throw new ApiError(\n      response.status,\n      'PARSE_ERROR',\n      'Failed to parse response'\n    );\n  }\n\n  if (!response.ok || !json.success) {\n    const error = 'error' in json ? json.error : undefined;\n    throw new ApiError(\n      response.status,\n      error?.code ?? 'UNKNOWN_ERROR',\n      error?.message ?? 'An error occurred',\n      error?.details\n    );\n  }\n\n  return json as ApiSuccessResponse<T>;\n}\n\n/**\n * Build full URL with query parameters\n */\nfunction buildUrl(endpoint: string, params?: QueryParams): string {\n  const queryString = params ? buildQueryString(params) : '';\n  return `${API_BASE}${endpoint}${queryString}`;\n}\n\n/**\n * API client with typed methods\n */\nexport const apiClient = {\n  async get<T>(endpoint: string, params?: QueryParams): Promise<T> {\n    const doFetch = async (): Promise<T> => {\n      const response = await fetch(buildUrl(endpoint, params), {\n        method: 'GET',\n        headers: {\n          'Content-Type': 'application/json',\n          ...getAuthHeaders(),\n        },\n      });\n      return handleResponse<T>(response, doFetch);\n    };\n    return doFetch();\n  },\n\n  async getWithMeta<T>(endpoint: string, params?: QueryParams): Promise<ApiSuccessResponse<T>> {\n    const doFetch = async (): Promise<ApiSuccessResponse<T>> => {\n      const response = await fetch(buildUrl(endpoint, params), {\n        method: 'GET',\n        headers: {\n          'Content-Type': 'application/json',\n          ...getAuthHeaders(),\n        },\n      });\n      return handleResponseWithMeta<T>(response, doFetch);\n    };\n    return doFetch();\n  },\n\n  async post<T>(endpoint: string, body?: unknown): Promise<T> {\n    const doFetch = async (): Promise<T> => {\n      const response = await fetch(buildUrl(endpoint), {\n        method: 'POST',\n        headers: {\n          'Content-Type': 'application/json',\n          ...getAuthHeaders(),\n        },\n        body: body ? JSON.stringify(body) : undefined,\n      });\n      return handleResponse<T>(response, doFetch);\n    };\n    return doFetch();\n  },\n\n  async patch<T>(endpoint: string, body?: unknown): Promise<T> {\n    const doFetch = async (): Promise<T> => {\n      const response = await fetch(buildUrl(endpoint), {\n        method: 'PATCH',\n        headers: {\n          'Content-Type': 'application/json',\n          ...getAuthHeaders(),\n        },\n        body: body ? JSON.stringify(body) : undefined,\n      });\n      return handleResponse<T>(response, doFetch);\n    };\n    return doFetch();\n  },\n\n  async put<T>(endpoint: string, body?: unknown): Promise<T> {\n    const doFetch = async (): Promise<T> => {\n      const response = await fetch(buildUrl(endpoint), {\n        method: 'PUT',\n        headers: {\n          'Content-Type': 'application/json',\n          ...getAuthHeaders(),\n        },\n        body: body ? JSON.stringify(body) : undefined,\n      });\n      return handleResponse<T>(response, doFetch);\n    };\n    return doFetch();\n  },\n\n  async delete<T>(endpoint: string): Promise<T> {\n    const doFetch = async (): Promise<T> => {\n      const response = await fetch(buildUrl(endpoint), {\n        method: 'DELETE',\n        headers: {\n          'Content-Type': 'application/json',\n          ...getAuthHeaders(),\n        },\n      });\n      return handleResponse<T>(response, doFetch);\n    };\n    return doFetch();\n  },\n};\n"],"names":["Skeleton","className","props","jsx","cn","buildFilterParams","filters","result","field","value","op","opValue","buildQueryString","params","searchParams","key","filterParams","filterKey","filterValue","queryString","API_BASE","ApiError","status","code","message","details","isRefreshing","refreshPromise","getAuthHeaders","token","refreshAccessToken","refreshToken","response","json","_a","handleUnauthorized","success","handleResponse","retryFn","error","handleResponseWithMeta","buildUrl","endpoint","apiClient","doFetch","body"],"mappings":"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"}