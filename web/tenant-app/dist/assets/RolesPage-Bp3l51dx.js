import{b as M,r as l,j as e,L as A,e as v,S as Y}from"./index-Dh87D1Ms.js";import{D as $,a as V,b as H,c as W,d as G,I as T,C as z,B as O,e as J,f as p,S as Z,T as _,g as ee}from"./dialog-RtiktQL8.js";import{P as B}from"./plus-BhVm2Ofv.js";import"./check-DVQOtCr5.js";function se({open:i,onOpenChange:N,onSuccess:I,role:n}){const{t:c}=M("roles"),[o,b]=l.useState(!1),[j,f]=l.useState(null),[y,k]=l.useState([]),[w,F]=l.useState(!0),[d,x]=l.useState({name:"",slug:"",description:"",permissionIds:[]}),u=!!n;l.useEffect(()=>{async function s(){try{const t=await v.get("/permissions");k(t)}catch(t){console.error("Failed to load permissions:",t)}finally{F(!1)}}i&&s()},[i]),l.useEffect(()=>{i&&n?x({name:n.name,slug:n.slug,description:n.description||"",permissionIds:n.permissions.map(s=>s.id)}):i&&x({name:"",slug:"",description:"",permissionIds:[]}),f(null)},[i,n]);const E=async s=>{s.preventDefault(),f(null),b(!0);try{u&&n?await v.put(`/roles/${n.id}`,{name:d.name,description:d.description||void 0,permissionIds:d.permissionIds}):await v.post("/roles",{name:d.name,slug:d.slug,description:d.description||void 0,permissionIds:d.permissionIds}),I(),N(!1)}catch(t){f(t instanceof Error?t.message:"An error occurred")}finally{b(!1)}},C=s=>s.toLowerCase().replace(/[^a-z0-9]+/g,"-").replace(/^-|-$/g,""),S=s=>{x(t=>({...t,name:s,slug:!u&&t.slug===C(t.name)?C(s):t.slug}))},R=s=>{x(t=>({...t,permissionIds:t.permissionIds.includes(s)?t.permissionIds.filter(h=>h!==s):[...t.permissionIds,s]}))},D=s=>{const h=y.filter(m=>m.module===s).map(m=>m.id),g=h.every(m=>d.permissionIds.includes(m));x(m=>({...m,permissionIds:g?m.permissionIds.filter(r=>!h.includes(r)):[...new Set([...m.permissionIds,...h])]}))},L=y.reduce((s,t)=>{const h=s[t.module]??[];return s[t.module]=[...h,t],s},{});return e.jsx($,{open:i,onOpenChange:N,children:e.jsxs(V,{className:"sm:max-w-[600px] max-h-[85vh] overflow-y-auto",children:[e.jsxs(H,{children:[e.jsx(W,{children:c(u?"editDialog.title":"createDialog.title")}),e.jsx(G,{children:c(u?"editDialog.description":"createDialog.description")})]}),e.jsxs("form",{onSubmit:E,className:"space-y-6",children:[j&&e.jsx("div",{className:"rounded-md bg-destructive/10 p-3 text-sm text-destructive",children:j}),e.jsxs("div",{className:"grid gap-4 sm:grid-cols-2",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs("label",{htmlFor:"name",className:"text-sm font-medium",children:[c("fields.name")," *"]}),e.jsx(T,{id:"name",value:d.name,onChange:s=>S(s.target.value),placeholder:c("fields.namePlaceholder"),required:!0,disabled:o||u&&(n==null?void 0:n.isSystem)})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("label",{htmlFor:"slug",className:"text-sm font-medium",children:[c("fields.slug")," *"]}),e.jsx(T,{id:"slug",value:d.slug,onChange:s=>x(t=>({...t,slug:s.target.value})),placeholder:c("fields.slugPlaceholder"),required:!0,disabled:o||u})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{htmlFor:"description",className:"text-sm font-medium",children:c("fields.description")}),e.jsx(T,{id:"description",value:d.description,onChange:s=>x(t=>({...t,description:s.target.value})),placeholder:c("fields.descriptionPlaceholder"),disabled:o})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("label",{className:"text-sm font-medium",children:c("fields.permissions")}),w?e.jsx("div",{className:"flex items-center justify-center py-8",children:e.jsx(A,{className:"h-6 w-6 animate-spin text-muted-foreground"})}):e.jsx("div",{className:"space-y-4 rounded-lg border p-4 max-h-[300px] overflow-y-auto",children:Object.entries(L).map(([s,t])=>{const h=t.map(r=>r.id),g=h.every(r=>d.permissionIds.includes(r)),m=h.some(r=>d.permissionIds.includes(r))&&!g;return e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(z,{checked:g||(m?"indeterminate":!1),onCheckedChange:()=>D(s),disabled:o||u&&(n==null?void 0:n.isSystem)}),e.jsx("span",{className:"font-medium capitalize",children:s}),e.jsx(O,{variant:"secondary",className:"text-xs",children:t.length})]}),e.jsx("div",{className:"ms-6 grid gap-2 sm:grid-cols-2",children:t.map(r=>e.jsxs("label",{className:"flex items-center gap-2 text-sm cursor-pointer",children:[e.jsx(z,{checked:d.permissionIds.includes(r.id),onCheckedChange:()=>R(r.id),disabled:o||u&&(n==null?void 0:n.isSystem)}),e.jsx("span",{className:"text-muted-foreground",children:r.action})]},r.id))})]},s)})})]}),e.jsxs(J,{children:[e.jsx(p,{type:"button",variant:"outline",onClick:()=>N(!1),disabled:o,children:c("actions.cancel")}),e.jsx(p,{type:"submit",disabled:o||u&&(n==null?void 0:n.isSystem),children:o?e.jsxs(e.Fragment,{children:[e.jsx(A,{className:"me-2 h-4 w-4 animate-spin"}),c(u?"actions.saving":"actions.creating")]}):c(u?"actions.save":"actions.create")})]})]})]})})}function le(){const{t:i}=M("roles"),[N,I]=l.useState([]),[n,c]=l.useState(!0),[o,b]=l.useState(""),[j,f]=l.useState(1),[y,k]=l.useState(20),[w,F]=l.useState(0),[d,x]=l.useState(1),[u,E]=l.useState([]),[C,S]=l.useState(!1),[R,D]=l.useState(null),[L,s]=l.useState(!1),[t,h]=l.useState(null),[g,m]=l.useState(!1),r=l.useCallback(async()=>{c(!0);try{const a={page:String(j),perPage:String(y)};o&&(a.q=o);const P=await v.getWithMeta("/roles",a);I(P.data),P.meta&&(F(P.meta.total??0),x(P.meta.totalPages??1))}catch(a){console.error("Failed to fetch roles:",a)}finally{c(!1)}},[j,y,o]);l.useEffect(()=>{r()},[r]),l.useEffect(()=>{const a=setTimeout(()=>{f(1)},300);return()=>clearTimeout(a)},[o]);const K=a=>{D(a),S(!0)},q=()=>{D(null),S(!0)},Q=a=>{h(a),s(!0)},U=async()=>{if(t){m(!0);try{await v.delete(`/roles/${t.id}`),r(),s(!1),h(null)}catch(a){console.error("Failed to delete role:",a)}finally{m(!1)}}},X=[{key:"name",header:i("columns.name"),cell:a=>e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"flex h-9 w-9 items-center justify-center rounded-lg bg-primary/10",children:e.jsx(Y,{className:"h-4 w-4 text-primary"})}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("p",{className:"font-medium",children:a.name}),a.isSystem&&e.jsx(O,{variant:"outline",className:"text-xs",children:i("systemRole")})]}),e.jsx("p",{className:"text-xs text-muted-foreground",children:a.description||a.slug})]})]})},{key:"permissionsCount",header:i("columns.permissions"),className:"text-center",cell:a=>e.jsx(O,{variant:"secondary",children:a.permissionsCount})},{key:"membersCount",header:i("columns.members"),className:"text-center",cell:a=>a.membersCount},{key:"createdAt",header:i("columns.createdAt"),cell:a=>new Date(a.createdAt).toLocaleDateString()},{key:"actions",header:i("columns.actions"),cell:a=>e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(p,{variant:"ghost",size:"icon",className:"h-8 w-8",onClick:()=>K(a),disabled:a.isSystem,children:e.jsx(Z,{className:"h-4 w-4"})}),!a.isSystem&&e.jsx(p,{variant:"ghost",size:"icon",className:"h-8 w-8 text-destructive",onClick:()=>Q(a),children:e.jsx(_,{className:"h-4 w-4"})})]}),className:"w-[80px]"}];return e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"flex flex-col gap-4 sm:flex-row sm:items-center sm:justify-between",children:e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold md:text-3xl",children:i("title")}),e.jsx("p",{className:"text-muted-foreground",children:i("subtitle")})]})}),e.jsx(ee,{columns:X,data:N,isLoading:n,searchValue:o,onSearchChange:b,searchPlaceholder:i("searchPlaceholder"),page:j,totalPages:d,total:w,perPage:y,onPageChange:f,onPerPageChange:a=>{k(a),f(1)},selectable:!0,selectedIds:u,onSelectionChange:E,onRefresh:r,actions:e.jsxs(p,{onClick:q,children:[e.jsx(B,{className:"h-4 w-4"}),e.jsx("span",{className:"hidden sm:inline ms-2",children:i("addRole")})]}),emptyVariant:"roles",emptyAction:e.jsxs(p,{onClick:q,children:[e.jsx(B,{className:"h-4 w-4 me-2"}),i("addRole")]})}),e.jsx(se,{open:C,onOpenChange:S,onSuccess:r,role:R}),e.jsx($,{open:L,onOpenChange:s,children:e.jsxs(V,{children:[e.jsxs(H,{children:[e.jsx(W,{children:i("deleteDialog.title")}),e.jsx(G,{children:i("deleteDialog.description",{name:t==null?void 0:t.name})})]}),e.jsxs(J,{children:[e.jsx(p,{variant:"outline",onClick:()=>s(!1),disabled:g,children:i("actions.cancel")}),e.jsx(p,{variant:"destructive",onClick:U,disabled:g,children:g?e.jsxs(e.Fragment,{children:[e.jsx(A,{className:"me-2 h-4 w-4 animate-spin"}),i("actions.deleting")]}):i("actions.delete")})]})]})})]})}export{le as RolesPage};
//# sourceMappingURL=RolesPage-Bp3l51dx.js.map
