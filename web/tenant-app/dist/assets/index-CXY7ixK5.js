import{c as G,j as e,d as V,r as g,B as y,p as J,P as I}from"./index-3LWobmh4.js";import{D as K}from"./DataTableAdvanced-BaepryHP.js";import{L as x,B as Q}from"./label-C6xqjT5A.js";import{D as W,a as X,E as Y,b as Z,c as E,k as ee,T as M,A as se,d as ae,e as te,f as ne,g as le,h as ie,i as re,j as ce}from"./alert-dialog-C58uG3WD.js";import{P as w}from"./PermissionGate-DepzuOZr.js";import{S as L,b as B,c as R,d as de,e as oe,I as j}from"./select-DSHg5FKg.js";import{u as q,g as D}from"./index-e_Is6BP0.js";import{u as me,a as ue,b as pe,c as he}from"./hooks-cDJzJ6Ki.js";import{S as xe,a as ge,b as je,c as fe,d as ve,e as Ne,P as ye}from"./sheet-DYSTWhzn.js";import{S as be}from"./skeleton-CkBj2wMt.js";import{M as Se}from"./mail-D_lj3mZN.js";import{B as Ce}from"./ban-CAM-JbPt.js";/**
 * @license lucide-react v0.513.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ae=[["path",{d:"M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8",key:"1357e3"}],["path",{d:"M3 3v5h5",key:"1xhq8a"}]],Pe=G("rotate-ccw",Ae);function ke({value:t,onChange:m,disabled:a,placeholder:n="Select country",showFlag:u=!0,showCode:p=!1,className:d,error:b,id:f,name:l}){const{data:r,isLoading:h,isError:S}=q(),v=i=>{const A=r==null?void 0:r.find(P=>P.id===i);m==null||m(i,A)},N=r==null?void 0:r.find(i=>i.id===t);return h?e.jsx(be,{className:"h-10 w-full"}):S?e.jsx(L,{disabled:!0,children:e.jsx(B,{className:d,children:e.jsx(R,{placeholder:"Failed to load countries"})})}):e.jsxs(L,{value:t,onValueChange:v,disabled:a,name:l,children:[e.jsx(B,{id:f,className:`${d} ${b?"border-red-500":""}`,children:e.jsx(R,{placeholder:n,children:N&&e.jsxs("span",{className:"flex items-center gap-2",children:[u&&e.jsx("span",{className:"text-lg",children:D(N.code)}),p&&e.jsx("span",{className:"font-mono text-muted-foreground",children:N.code}),e.jsx("span",{children:N.nameEn})]})})}),e.jsx(de,{children:r==null?void 0:r.map(i=>e.jsx(oe,{value:i.id,children:e.jsxs("span",{className:"flex items-center gap-2",children:[u&&e.jsx("span",{className:"text-lg",children:D(i.code)}),p&&e.jsx("span",{className:"font-mono text-muted-foreground",children:i.code}),e.jsx("span",{children:i.nameEn})]})},i.id))})]})}const z={nameEn:"",nameAr:"",countryId:"",countryCode:"",city:"",licenseNumber:"",phone:"",email:"",website:"",notes:""};function Ee({open:t,onOpenChange:m}){const{t:a}=V("suppliers"),[n,u]=g.useState(z),p=me(),d=(l,r)=>u(h=>({...h,[l]:r})),b=(l,r)=>{u(h=>({...h,countryId:l,countryCode:(r==null?void 0:r.code)??""}))},f=async l=>{l.preventDefault(),!(!n.nameEn.trim()||!n.countryCode)&&(await p.mutateAsync({nameEn:n.nameEn.trim(),nameAr:n.nameAr.trim()||void 0,country:n.countryCode,city:n.city.trim()||void 0,licenseNumber:n.licenseNumber.trim()||void 0,phone:n.phone.trim()||void 0,email:n.email.trim()||void 0,website:n.website.trim()||void 0,notes:n.notes.trim()||void 0}),u(z),m(!1))};return e.jsx(xe,{open:t,onOpenChange:m,children:e.jsx(ge,{side:"right",className:"overflow-y-auto",children:e.jsxs("form",{onSubmit:f,className:"flex flex-col h-full",children:[e.jsxs(je,{children:[e.jsx(fe,{children:a("add.title")}),e.jsx(ve,{children:a("add.description")})]}),e.jsxs("div",{className:"grid gap-4 py-6 flex-1",children:[e.jsxs("div",{className:"grid gap-2",children:[e.jsxs(x,{htmlFor:"nameEn",children:[a("add.nameEn")," ",e.jsx("span",{className:"text-destructive",children:"*"})]}),e.jsx(j,{id:"nameEn",placeholder:a("add.nameEnPlaceholder"),value:n.nameEn,onChange:l=>d("nameEn",l.target.value),required:!0})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(x,{htmlFor:"nameAr",children:a("add.nameAr")}),e.jsx(j,{id:"nameAr",placeholder:a("add.nameArPlaceholder"),value:n.nameAr,onChange:l=>d("nameAr",l.target.value),dir:"rtl"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"grid gap-2",children:[e.jsxs(x,{htmlFor:"country",children:[a("add.country")," ",e.jsx("span",{className:"text-destructive",children:"*"})]}),e.jsx(ke,{id:"country",value:n.countryId,onChange:b,placeholder:a("add.countryPlaceholder"),showFlag:!0,showCode:!0})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(x,{htmlFor:"city",children:a("add.city")}),e.jsx(j,{id:"city",placeholder:a("add.cityPlaceholder"),value:n.city,onChange:l=>d("city",l.target.value)})]})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(x,{htmlFor:"licenseNumber",children:a("add.licenseNumber")}),e.jsx(j,{id:"licenseNumber",placeholder:a("add.licenseNumberPlaceholder"),value:n.licenseNumber,onChange:l=>d("licenseNumber",l.target.value)})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"grid gap-2",children:[e.jsx(x,{htmlFor:"phone",children:a("add.phone")}),e.jsx(j,{id:"phone",type:"tel",placeholder:a("add.phonePlaceholder"),value:n.phone,onChange:l=>d("phone",l.target.value)})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(x,{htmlFor:"email",children:a("add.email")}),e.jsx(j,{id:"email",type:"email",placeholder:a("add.emailPlaceholder"),value:n.email,onChange:l=>d("email",l.target.value)})]})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(x,{htmlFor:"website",children:a("add.website")}),e.jsx(j,{id:"website",type:"url",placeholder:a("add.websitePlaceholder"),value:n.website,onChange:l=>d("website",l.target.value)})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(x,{htmlFor:"notes",children:a("add.notes")}),e.jsx("textarea",{id:"notes",className:"flex min-h-[80px] w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",placeholder:a("add.notesPlaceholder"),value:n.notes,onChange:l=>d("notes",l.target.value),rows:3})]})]}),e.jsxs(Ne,{children:[e.jsx(y,{type:"button",variant:"outline",onClick:()=>m(!1),children:a("common:cancel")}),e.jsx(y,{type:"submit",disabled:p.isPending||!n.nameEn.trim()||!n.countryCode,children:p.isPending?a("add.submitting"):a("add.submit")})]})]})})})}const we={Active:"default",Suspended:"secondary",Terminated:"destructive"};function He(){const{t}=V("suppliers"),{hasPermission:m}=J(),[a,n]=g.useState(""),[u,p]=g.useState(1),[d,b]=g.useState(20),[f,l]=g.useState([]),[r,h]=g.useState(!1),[S,v]=g.useState(null),N=g.useMemo(()=>({page:u,pageSize:d,search:a||void 0,sort:"-createdAt"}),[u,d,a]),{data:i,isLoading:A,refetch:P}=ue(N),{data:k}=q(),$=pe(),H=he(),O=s=>{if(!s)return"—";const c=k==null?void 0:k.find(o=>o.code===s);return(c==null?void 0:c.nameEn)??s},U=async()=>{S&&(await $.mutateAsync(S.id),v(null))},F=async(s,c)=>{await H.mutateAsync({id:s.id,data:{status:c}})},_=[{key:"name",header:t("columns.name"),cell:s=>{var c,o;return e.jsxs("div",{className:"min-w-0",children:[e.jsx("p",{className:"font-medium truncate",children:((c=s.supplier)==null?void 0:c.nameEn)??"—"}),((o=s.supplier)==null?void 0:o.nameAr)&&e.jsx("p",{className:"text-xs text-muted-foreground truncate",dir:"rtl",children:s.supplier.nameAr})]})}},{key:"country",header:t("columns.country"),cell:s=>{var c,o,C;return e.jsxs("div",{className:"flex items-center gap-1.5",children:[((c=s.supplier)==null?void 0:c.country)&&e.jsx("span",{className:"text-lg leading-none",children:D(s.supplier.country)}),e.jsx("span",{children:O((o=s.supplier)==null?void 0:o.country)}),((C=s.supplier)==null?void 0:C.city)&&e.jsxs("span",{className:"text-muted-foreground",children:["/ ",s.supplier.city]})]})}},{key:"contact",header:t("columns.contact"),cell:s=>{var c,o,C,T;return e.jsxs("div",{className:"flex flex-col gap-0.5 text-sm",children:[(c=s.supplier)!=null&&c.email?e.jsxs("span",{className:"flex items-center gap-1.5 text-muted-foreground",children:[e.jsx(Se,{className:"h-3 w-3"}),e.jsx("span",{className:"truncate max-w-[180px]",children:s.supplier.email})]}):null,(o=s.supplier)!=null&&o.phone?e.jsxs("span",{className:"flex items-center gap-1.5 text-muted-foreground",children:[e.jsx(ye,{className:"h-3 w-3"}),s.supplier.phone]}):null,!((C=s.supplier)!=null&&C.email)&&!((T=s.supplier)!=null&&T.phone)&&e.jsx("span",{className:"text-xs text-muted-foreground",children:t("noContact")})]})}},{key:"status",header:t("columns.status"),cell:s=>e.jsx(Q,{variant:we[s.status]??"secondary",children:t(`status.${s.status}`)})},{key:"actions",header:t("columns.actions"),className:"w-[70px]",cell:s=>e.jsxs(W,{children:[e.jsx(X,{asChild:!0,children:e.jsx(y,{variant:"ghost",size:"icon",className:"h-8 w-8",children:e.jsx(Y,{className:"h-4 w-4"})})}),e.jsxs(Z,{align:"end",children:[m("suppliers.manage")&&s.status==="Active"&&e.jsxs(E,{onClick:()=>F(s,"Suspended"),children:[e.jsx(Ce,{className:"me-2 h-4 w-4"}),t("actions.suspend")]}),m("suppliers.manage")&&s.status==="Suspended"&&e.jsxs(E,{onClick:()=>F(s,"Active"),children:[e.jsx(Pe,{className:"me-2 h-4 w-4"}),t("actions.reactivate")]}),m("suppliers.delete")&&e.jsxs(e.Fragment,{children:[e.jsx(ee,{}),e.jsxs(E,{className:"text-destructive",onClick:()=>v(s),children:[e.jsx(M,{className:"me-2 h-4 w-4"}),t("actions.remove")]})]})]})]})}];return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold tracking-tight",children:t("title")}),e.jsx("p",{className:"text-muted-foreground",children:t("description")})]}),e.jsx(K,{columns:_,data:(i==null?void 0:i.items)??[],isLoading:A,selectable:!0,selectedIds:f,onSelectionChange:l,searchPlaceholder:t("searchPlaceholder"),searchValue:a,onSearchChange:s=>{n(s),p(1)},page:u,totalPages:i==null?void 0:i.totalPages,total:i==null?void 0:i.totalCount,pageSize:d,onPageChange:p,onPageSizeChange:b,onRefresh:()=>P(),emptyVariant:"default",emptyTitle:t("empty.title"),emptyDescription:t("empty.description"),emptyAction:e.jsx(w,{permission:"suppliers.manage",children:e.jsxs(y,{onClick:()=>h(!0),children:[e.jsx(I,{className:"me-2 h-4 w-4"}),t("addSupplier")]})}),actions:e.jsx(w,{permission:"suppliers.manage",children:e.jsxs(y,{onClick:()=>h(!0),children:[e.jsx(I,{className:"me-2 h-4 w-4"}),t("addSupplier")]})}),bulkActions:e.jsx(w,{permission:"suppliers.delete",children:e.jsxs(y,{variant:"destructive",size:"sm",onClick:()=>{const c=((i==null?void 0:i.items)??[]).find(o=>f.includes(o.id));c&&v(c)},children:[e.jsx(M,{className:"me-2 h-4 w-4"}),t("actions.remove")]})})}),e.jsx(Ee,{open:r,onOpenChange:h}),e.jsx(se,{open:!!S,onOpenChange:()=>v(null),children:e.jsxs(ae,{children:[e.jsxs(te,{children:[e.jsx(ne,{children:t("remove.title")}),e.jsx(le,{children:t("remove.description")})]}),e.jsxs(ie,{children:[e.jsx(re,{children:t("common:cancel")}),e.jsx(ce,{onClick:U,className:"bg-destructive text-destructive-foreground hover:bg-destructive/90",children:t("remove.confirm")})]})]})})]})}export{He as SuppliersPage};
//# sourceMappingURL=index-CXY7ixK5.js.map
