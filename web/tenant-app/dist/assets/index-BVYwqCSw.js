import{r as c,j as e,i as Te,g as G,h as C,l as qe,m as Y,n as k,o as A,d as I,B as N,p as _e,U as Fe}from"./index-3LWobmh4.js";import{T as $e,a as Oe,b as ee,c as te}from"./tabs-CAZbEoeM.js";import{D as re,S as Ke}from"./DataTableAdvanced-BaepryHP.js";import{u as Be,a as T,I as ze,S as Ve,b as Ue,c as Qe,d as He,e as Ge,C as Ye}from"./select-DSHg5FKg.js";import{P as W,L as q,B as _}from"./label-C6xqjT5A.js";import{D as ie,a as oe,E as le,b as ce,c as F,T as $,A as O,d as K,e as B,f as z,g as V,h as U,i as Q,j as H,k as We}from"./alert-dialog-C58uG3WD.js";import{P as E}from"./PermissionGate-DepzuOZr.js";import{D as ue,a as de,b as me,c as he,d as xe,e as ve}from"./dialog-dlmPZOCs.js";import{M as Je}from"./mail-D_lj3mZN.js";import{U as D}from"./user-plus-B4EfnQJR.js";import"./skeleton-CkBj2wMt.js";function Xe(t,s=[]){let n=[];function u(i,m){const o=c.createContext(m);o.displayName=i+"Context";const a=n.length;n=[...n,m];const f=r=>{var g;const{scope:h,children:p,...x}=r,l=((g=h==null?void 0:h[t])==null?void 0:g[a])||o,y=c.useMemo(()=>x,Object.values(x));return e.jsx(l.Provider,{value:y,children:p})};f.displayName=i+"Provider";function j(r,h){var l;const p=((l=h==null?void 0:h[t])==null?void 0:l[a])||o,x=c.useContext(p);if(x)return x;if(m!==void 0)return m;throw new Error(`\`${r}\` must be used within \`${i}\``)}return[f,j]}const d=()=>{const i=n.map(m=>c.createContext(m));return function(o){const a=(o==null?void 0:o[t])||i;return c.useMemo(()=>({[`__scope${t}`]:{...o,[t]:a}}),[o,a])}};return d.scopeName=t,[u,Ze(d,...s)]}function Ze(...t){const s=t[0];if(t.length===1)return s;const n=()=>{const u=t.map(d=>({useScope:d(),scopeName:d.scopeName}));return function(i){const m=u.reduce((o,{useScope:a,scopeName:f})=>{const r=a(i)[`__scope${f}`];return{...o,...r}},{});return c.useMemo(()=>({[`__scope${s.scopeName}`]:m}),[m])}};return n.scopeName=s.scopeName,n}var M={exports:{}},L={};/**
 * @license React
 * use-sync-external-store-shim.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var se;function et(){if(se)return L;se=1;var t=Te();function s(r,h){return r===h&&(r!==0||1/r===1/h)||r!==r&&h!==h}var n=typeof Object.is=="function"?Object.is:s,u=t.useState,d=t.useEffect,i=t.useLayoutEffect,m=t.useDebugValue;function o(r,h){var p=h(),x=u({inst:{value:p,getSnapshot:h}}),l=x[0].inst,y=x[1];return i(function(){l.value=p,l.getSnapshot=h,a(l)&&y({inst:l})},[r,p,h]),d(function(){return a(l)&&y({inst:l}),r(function(){a(l)&&y({inst:l})})},[r]),m(p),p}function a(r){var h=r.getSnapshot;r=r.value;try{var p=h();return!n(r,p)}catch{return!0}}function f(r,h){return h()}var j=typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"?f:o;return L.useSyncExternalStore=t.useSyncExternalStore!==void 0?t.useSyncExternalStore:j,L}var ne;function tt(){return ne||(ne=1,M.exports=et()),M.exports}var st=tt();function nt(){return st.useSyncExternalStore(at,()=>!0,()=>!1)}function at(){return()=>{}}var J="Avatar",[rt]=Xe(J),[it,fe]=rt(J),ge=c.forwardRef((t,s)=>{const{__scopeAvatar:n,...u}=t,[d,i]=c.useState("idle");return e.jsx(it,{scope:n,imageLoadingStatus:d,onImageLoadingStatusChange:i,children:e.jsx(W.span,{...u,ref:s})})});ge.displayName=J;var pe="AvatarImage",je=c.forwardRef((t,s)=>{const{__scopeAvatar:n,src:u,onLoadingStatusChange:d=()=>{},...i}=t,m=fe(pe,n),o=ot(u,i),a=Be(f=>{d(f),m.onImageLoadingStatusChange(f)});return T(()=>{o!=="idle"&&a(o)},[o,a]),o==="loaded"?e.jsx(W.img,{...i,ref:s,src:u}):null});je.displayName=pe;var Se="AvatarFallback",ye=c.forwardRef((t,s)=>{const{__scopeAvatar:n,delayMs:u,...d}=t,i=fe(Se,n),[m,o]=c.useState(u===void 0);return c.useEffect(()=>{if(u!==void 0){const a=window.setTimeout(()=>o(!0),u);return()=>window.clearTimeout(a)}},[u]),m&&i.imageLoadingStatus!=="loaded"?e.jsx(W.span,{...d,ref:s}):null});ye.displayName=Se;function ae(t,s){return t?s?(t.src!==s&&(t.src=s),t.complete&&t.naturalWidth>0?"loaded":"loading"):"error":"idle"}function ot(t,{referrerPolicy:s,crossOrigin:n}){const u=nt(),d=c.useRef(null),i=u?(d.current||(d.current=new window.Image),d.current):null,[m,o]=c.useState(()=>ae(i,t));return T(()=>{o(ae(i,t))},[i,t]),T(()=>{const a=r=>()=>{o(r)};if(!i)return;const f=a("loaded"),j=a("error");return i.addEventListener("load",f),i.addEventListener("error",j),s&&(i.referrerPolicy=s),typeof n=="string"&&(i.crossOrigin=n),()=>{i.removeEventListener("load",f),i.removeEventListener("error",j)}},[i,n,s]),m}var be=ge,Ne=je,Ce=ye;const Re=c.forwardRef(({className:t,...s},n)=>e.jsx(be,{ref:n,className:G("relative flex h-10 w-10 shrink-0 overflow-hidden rounded-full",t),...s}));Re.displayName=be.displayName;const we=c.forwardRef(({className:t,...s},n)=>e.jsx(Ne,{ref:n,className:G("aspect-square h-full w-full",t),...s}));we.displayName=Ne.displayName;const ke=c.forwardRef(({className:t,...s},n)=>e.jsx(Ce,{ref:n,className:G("flex h-full w-full items-center justify-center rounded-full bg-muted text-sm font-medium",t),...s}));ke.displayName=Ce.displayName;function R(t){return`/tenants/${qe()}${t}`}function lt(t){return C.getPaged(R("/members"),t)}function ct(t){return C.delete(R(`/members/${t}`))}function ut(t){return C.getPaged(R("/invitations"),t)}function dt(t){return C.post(R("/invitations"),t)}function mt(t){return C.delete(R(`/invitations/${t}`))}function ht(t){return C.getPaged(R("/roles"),t)}function xt(t){return C.post(R("/roles/assign"),t)}function vt(t,s){return C.delete(R(`/roles/users/${t}/roles/${s}`))}const P="team-members",X="team-invitations",ft="team-roles";function gt(t){return Y({queryKey:[P,t],queryFn:()=>lt(t)})}function pt(){const t=k();return A({mutationFn:s=>ct(s),onSuccess:()=>{t.invalidateQueries({queryKey:[P]})}})}function jt(){const t=k();return A({mutationFn:s=>dt(s),onSuccess:()=>{t.invalidateQueries({queryKey:[X]})}})}function St(t){return Y({queryKey:[X,t],queryFn:()=>ut(t)})}function yt(){const t=k();return A({mutationFn:s=>mt(s),onSuccess:()=>{t.invalidateQueries({queryKey:[X]})}})}function Ae(){return Y({queryKey:[ft],queryFn:()=>ht({pageSize:100}),staleTime:300*1e3})}function bt(){const t=k();return A({mutationFn:s=>xt(s),onSuccess:()=>{t.invalidateQueries({queryKey:[P]})}})}function Nt(){const t=k();return A({mutationFn:({userId:s,roleId:n})=>vt(s,n),onSuccess:()=>{t.invalidateQueries({queryKey:[P]})}})}function Ct({open:t,onOpenChange:s}){const{t:n}=I("team"),[u,d]=c.useState(""),[i,m]=c.useState(""),o=jt(),{data:a}=Ae(),f=(a==null?void 0:a.items)??[],j=async r=>{r.preventDefault(),u.trim()&&(await o.mutateAsync({email:u.trim(),roleId:i||void 0}),d(""),m(""),s(!1))};return e.jsx(ue,{open:t,onOpenChange:s,children:e.jsx(de,{className:"sm:max-w-[425px]",children:e.jsxs("form",{onSubmit:j,children:[e.jsxs(me,{children:[e.jsx(he,{children:n("invite.title")}),e.jsx(xe,{children:n("invite.description")})]}),e.jsxs("div",{className:"grid gap-4 py-4",children:[e.jsxs("div",{className:"grid gap-2",children:[e.jsx(q,{htmlFor:"email",children:n("invite.emailLabel")}),e.jsx(ze,{id:"email",type:"email",placeholder:n("invite.emailPlaceholder"),value:u,onChange:r=>d(r.target.value),required:!0})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(q,{children:n("invite.roleLabel")}),e.jsxs(Ve,{value:i,onValueChange:m,children:[e.jsx(Ue,{children:e.jsx(Qe,{placeholder:n("invite.rolePlaceholder")})}),e.jsx(He,{children:f.map(r=>e.jsx(Ge,{value:r.id,children:r.name},r.id))})]})]})]}),e.jsxs(ve,{children:[e.jsx(N,{type:"button",variant:"outline",onClick:()=>s(!1),children:n("common:cancel")}),e.jsx(N,{type:"submit",disabled:o.isPending||!u.trim(),children:o.isPending?n("common:loading"):n("invite.submit")})]})]})})})}function Rt({open:t,onOpenChange:s,member:n}){const{t:u}=I("team"),{data:d}=Ae(),i=bt(),m=Nt(),[o,a]=c.useState(new Set),[f,j]=c.useState(!1),r=(d==null?void 0:d.items)??[],h=new Set((n==null?void 0:n.roles.map(l=>l.id))??[]);c.useEffect(()=>{n&&a(new Set(n.roles.map(l=>l.id)))},[n]);const p=l=>{a(y=>{const g=new Set(y);return g.has(l)?g.delete(l):g.add(l),g})},x=async()=>{if(n){j(!0);try{const l=[...o].filter(g=>!h.has(g)),y=[...h].filter(g=>!o.has(g));await Promise.all([...l.map(g=>i.mutateAsync({userId:n.userId,roleId:g})),...y.map(g=>m.mutateAsync({userId:n.userId,roleId:g}))]),s(!1)}finally{j(!1)}}};return e.jsx(ue,{open:t,onOpenChange:s,children:e.jsxs(de,{className:"sm:max-w-[425px]",children:[e.jsxs(me,{children:[e.jsx(he,{children:u("changeRole.title")}),e.jsx(xe,{children:u("changeRole.description",{name:n==null?void 0:n.fullName})})]}),e.jsx("div",{className:"grid gap-3 py-4",children:r.map(l=>e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(Ye,{id:`role-${l.id}`,checked:o.has(l.id),onCheckedChange:()=>p(l.id)}),e.jsxs(q,{htmlFor:`role-${l.id}`,className:"flex-1 cursor-pointer",children:[e.jsx("span",{className:"font-medium",children:l.name}),l.description&&e.jsx("span",{className:"block text-xs text-muted-foreground",children:l.description})]})]},l.id))}),e.jsxs(ve,{children:[e.jsx(N,{variant:"outline",onClick:()=>s(!1),children:u("common:cancel")}),e.jsx(N,{onClick:x,disabled:f,children:u(f?"common:loading":"changeRole.save")})]})]})})}function wt({onInvite:t}){const{t:s}=I("team"),[n,u]=c.useState(1),[d,i]=c.useState(20),[m,o]=c.useState(null),{data:a,isLoading:f,refetch:j}=St({page:n,pageSize:d}),r=yt(),h=async()=>{m&&(await r.mutateAsync(m.id),o(null))},p=[{key:"email",header:s("invitations.email"),cell:x=>e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Je,{className:"h-4 w-4 text-muted-foreground"}),e.jsx("span",{className:"font-medium",children:x.email})]})},{key:"invitedByName",header:s("invitations.invitedBy")},{key:"status",header:s("invitations.status"),cell:x=>e.jsx(_,{variant:x.isExpired?"destructive":"warning",children:x.isExpired?s("invitations.expired"):s("invitations.pending")})},{key:"expiresAt",header:s("invitations.expires"),cell:x=>new Date(x.expiresAt).toLocaleDateString()},{key:"actions",header:s("invitations.actions"),className:"w-[70px]",cell:x=>e.jsxs(ie,{children:[e.jsx(oe,{asChild:!0,children:e.jsx(N,{variant:"ghost",size:"icon",className:"h-8 w-8",children:e.jsx(le,{className:"h-4 w-4"})})}),e.jsx(ce,{align:"end",children:e.jsxs(F,{className:"text-destructive",onClick:()=>o(x),children:[e.jsx($,{className:"me-2 h-4 w-4"}),s("invitations.revoke")]})})]})}];return e.jsxs(e.Fragment,{children:[e.jsx(re,{columns:p,data:(a==null?void 0:a.items)??[],isLoading:f,page:n,totalPages:a==null?void 0:a.totalPages,total:a==null?void 0:a.totalCount,pageSize:d,onPageChange:u,onPageSizeChange:i,onRefresh:()=>j(),emptyVariant:"team",emptyTitle:s("empty.invitations.title"),emptyDescription:s("empty.invitations.description"),emptyAction:e.jsx(N,{onClick:t,children:s("invite.title")}),actions:e.jsx(N,{onClick:t,children:s("invite.title")})}),e.jsx(O,{open:!!m,onOpenChange:()=>o(null),children:e.jsxs(K,{children:[e.jsxs(B,{children:[e.jsx(z,{children:s("invitations.revoke")}),e.jsx(V,{children:s("invitations.confirmRevoke")})]}),e.jsxs(U,{children:[e.jsx(Q,{children:s("common:cancel")}),e.jsx(H,{onClick:h,className:"bg-destructive text-destructive-foreground hover:bg-destructive/90",children:s("invitations.revoke")})]})]})})]})}function Ft(){const{t}=I("team"),{hasPermission:s}=_e(),[n,u]=c.useState(""),[d,i]=c.useState(1),[m,o]=c.useState(20),[a,f]=c.useState([]),[j,r]=c.useState(!1),[h,p]=c.useState(null),[x,l]=c.useState(null),[y,g]=c.useState(!1),Ie=c.useMemo(()=>({page:d,pageSize:m,search:n||void 0}),[d,m,n]),{data:S,isLoading:Pe,refetch:Ee}=gt(Ie),Z=pt(),De=async()=>{x&&(await Z.mutateAsync(x.userId),l(null))},Me=async()=>{const w=((S==null?void 0:S.items)??[]).filter(b=>a.includes(b.id));await Promise.all(w.map(b=>Z.mutateAsync(b.userId))),f([]),g(!1)},Le=[{key:"name",header:t("members.name"),cell:v=>{var w,b;return e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs(Re,{className:"h-8 w-8",children:[v.avatarUrl&&e.jsx(we,{src:v.avatarUrl,alt:v.fullName}),e.jsxs(ke,{className:"text-xs",children:[((w=v.firstName)==null?void 0:w[0])??"",((b=v.lastName)==null?void 0:b[0])??""]})]}),e.jsxs("div",{className:"min-w-0",children:[e.jsx("p",{className:"font-medium truncate",children:v.fullName}),e.jsx("p",{className:"text-xs text-muted-foreground truncate",children:v.email})]})]})}},{key:"roles",header:t("members.roles"),cell:v=>{const w=v.isOwner?v.roles.filter(b=>b.name!=="Owner"):v.roles;return e.jsxs("div",{className:"flex flex-wrap gap-1",children:[v.isOwner&&e.jsx(_,{variant:"default",children:t("members.owner")}),w.map(b=>e.jsx(_,{variant:"secondary",children:b.name},b.id)),!v.isOwner&&w.length===0&&e.jsx("span",{className:"text-xs text-muted-foreground",children:t("members.noRoles")})]})}},{key:"joinedAt",header:t("members.joinedAt"),cell:v=>new Date(v.joinedAt).toLocaleDateString()},{key:"actions",header:t("members.actions"),className:"w-[70px]",cell:v=>e.jsxs(ie,{children:[e.jsx(oe,{asChild:!0,children:e.jsx(N,{variant:"ghost",size:"icon",className:"h-8 w-8",children:e.jsx(le,{className:"h-4 w-4"})})}),e.jsxs(ce,{align:"end",children:[s("members.manage")&&e.jsxs(F,{onClick:()=>p(v),children:[e.jsx(Ke,{className:"me-2 h-4 w-4"}),t("members.changeRole")]}),!v.isOwner&&s("members.remove")&&e.jsxs(e.Fragment,{children:[e.jsx(We,{}),e.jsxs(F,{className:"text-destructive",onClick:()=>l(v),children:[e.jsx($,{className:"me-2 h-4 w-4"}),t("members.removeMember")]})]})]})]})}];return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold tracking-tight",children:t("title")}),e.jsx("p",{className:"text-muted-foreground",children:t("description")})]}),e.jsxs($e,{defaultValue:"members",children:[e.jsxs(Oe,{children:[e.jsxs(ee,{value:"members",children:[e.jsx(Fe,{className:"me-2 h-4 w-4"}),t("tabs.members")]}),e.jsxs(ee,{value:"invitations",children:[e.jsx(D,{className:"me-2 h-4 w-4"}),t("tabs.invitations")]})]}),e.jsx(te,{value:"members",children:e.jsx(re,{columns:Le,data:(S==null?void 0:S.items)??[],isLoading:Pe,selectable:!0,selectedIds:a,onSelectionChange:f,searchPlaceholder:t("members.searchPlaceholder"),searchValue:n,onSearchChange:v=>{u(v),i(1)},page:d,totalPages:S==null?void 0:S.totalPages,total:S==null?void 0:S.totalCount,pageSize:m,onPageChange:i,onPageSizeChange:o,onRefresh:()=>Ee(),emptyVariant:"team",emptyTitle:t("empty.members.title"),emptyDescription:t("empty.members.description"),emptyAction:e.jsx(E,{permission:"members.invite",children:e.jsxs(N,{onClick:()=>r(!0),children:[e.jsx(D,{className:"me-2 h-4 w-4"}),t("invite.title")]})}),actions:e.jsx(E,{permission:"members.invite",children:e.jsxs(N,{onClick:()=>r(!0),children:[e.jsx(D,{className:"me-2 h-4 w-4"}),t("invite.title")]})}),bulkActions:e.jsx(E,{permission:"members.remove",children:e.jsxs(N,{variant:"destructive",size:"sm",onClick:()=>g(!0),children:[e.jsx($,{className:"me-2 h-4 w-4"}),t("members.removeSelected")]})})})}),e.jsx(te,{value:"invitations",children:e.jsx(wt,{onInvite:()=>r(!0)})})]}),e.jsx(Ct,{open:j,onOpenChange:r}),e.jsx(Rt,{open:!!h,onOpenChange:v=>!v&&p(null),member:h}),e.jsx(O,{open:!!x,onOpenChange:()=>l(null),children:e.jsxs(K,{children:[e.jsxs(B,{children:[e.jsx(z,{children:t("members.removeMember")}),e.jsx(V,{children:t("members.confirmRemove")})]}),e.jsxs(U,{children:[e.jsx(Q,{children:t("common:cancel")}),e.jsx(H,{onClick:De,className:"bg-destructive text-destructive-foreground hover:bg-destructive/90",children:t("members.removeMember")})]})]})}),e.jsx(O,{open:y,onOpenChange:g,children:e.jsxs(K,{children:[e.jsxs(B,{children:[e.jsx(z,{children:t("members.removeSelected")}),e.jsx(V,{children:t("members.confirmRemoveMultiple",{count:a.length})})]}),e.jsxs(U,{children:[e.jsx(Q,{children:t("common:cancel")}),e.jsx(H,{onClick:Me,className:"bg-destructive text-destructive-foreground hover:bg-destructive/90",children:t("members.removeSelected")})]})]})})]})}export{Ft as TeamPage};
//# sourceMappingURL=index-BVYwqCSw.js.map
