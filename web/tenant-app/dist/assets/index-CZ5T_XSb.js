import{c as De,r as u,j as e,h as Le,f as H,g as C,i as Te,l as w,d as I,U as qe}from"./index-Cqouy3Yt.js";import{D as ae,a as re,b as ie,c as oe,d as le,e as ce,T as _e,f as Fe,g as Z,h as ee}from"./dialog-BgCayfk_.js";import{P as Y,u as $e,a as L,b as G,c as A,L as T,I as Oe,S as Ke,d as Be,e as ze,f as Ve,g as Ue,C as Qe,B as q,D as ue,h as de,E as me,i as he,j as _,T as F,k as xe,A as $,l as O,m as K,n as B,o as z,p as V,q as U,r as Q,s as He,t as Ye}from"./label-DwNxcReA.js";import{B as N}from"./button-C8-5F-AC.js";import{M as Ge}from"./mail-Dhp7jO02.js";/**
 * @license lucide-react v0.513.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const We=[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["line",{x1:"19",x2:"19",y1:"8",y2:"14",key:"1bvyxn"}],["line",{x1:"22",x2:"16",y1:"11",y2:"11",key:"1shjgl"}]],P=De("user-plus",We);function Je(t,s=[]){let n=[];function l(a,m){const r=u.createContext(m);r.displayName=a+"Context";const i=n.length;n=[...n,m];const f=o=>{var j;const{scope:h,children:p,...x}=o,c=((j=h==null?void 0:h[t])==null?void 0:j[i])||r,y=u.useMemo(()=>x,Object.values(x));return e.jsx(c.Provider,{value:y,children:p})};f.displayName=a+"Provider";function g(o,h){var c;const p=((c=h==null?void 0:h[t])==null?void 0:c[i])||r,x=u.useContext(p);if(x)return x;if(m!==void 0)return m;throw new Error(`\`${o}\` must be used within \`${a}\``)}return[f,g]}const d=()=>{const a=n.map(m=>u.createContext(m));return function(r){const i=(r==null?void 0:r[t])||a;return u.useMemo(()=>({[`__scope${t}`]:{...r,[t]:i}}),[r,i])}};return d.scopeName=t,[l,Xe(d,...s)]}function Xe(...t){const s=t[0];if(t.length===1)return s;const n=()=>{const l=t.map(d=>({useScope:d(),scopeName:d.scopeName}));return function(a){const m=l.reduce((r,{useScope:i,scopeName:f})=>{const o=i(a)[`__scope${f}`];return{...r,...o}},{});return u.useMemo(()=>({[`__scope${s.scopeName}`]:m}),[m])}};return n.scopeName=s.scopeName,n}var M={exports:{}},D={};/**
 * @license React
 * use-sync-external-store-shim.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var te;function Ze(){if(te)return D;te=1;var t=Le();function s(o,h){return o===h&&(o!==0||1/o===1/h)||o!==o&&h!==h}var n=typeof Object.is=="function"?Object.is:s,l=t.useState,d=t.useEffect,a=t.useLayoutEffect,m=t.useDebugValue;function r(o,h){var p=h(),x=l({inst:{value:p,getSnapshot:h}}),c=x[0].inst,y=x[1];return a(function(){c.value=p,c.getSnapshot=h,i(c)&&y({inst:c})},[o,p,h]),d(function(){return i(c)&&y({inst:c}),o(function(){i(c)&&y({inst:c})})},[o]),m(p),p}function i(o){var h=o.getSnapshot;o=o.value;try{var p=h();return!n(o,p)}catch{return!0}}function f(o,h){return h()}var g=typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"?f:r;return D.useSyncExternalStore=t.useSyncExternalStore!==void 0?t.useSyncExternalStore:g,D}var se;function et(){return se||(se=1,M.exports=Ze()),M.exports}var tt=et();function st(){return tt.useSyncExternalStore(nt,()=>!0,()=>!1)}function nt(){return()=>{}}var W="Avatar",[at]=Je(W),[rt,ve]=at(W),fe=u.forwardRef((t,s)=>{const{__scopeAvatar:n,...l}=t,[d,a]=u.useState("idle");return e.jsx(rt,{scope:n,imageLoadingStatus:d,onImageLoadingStatusChange:a,children:e.jsx(Y.span,{...l,ref:s})})});fe.displayName=W;var ge="AvatarImage",pe=u.forwardRef((t,s)=>{const{__scopeAvatar:n,src:l,onLoadingStatusChange:d=()=>{},...a}=t,m=ve(ge,n),r=it(l,a),i=$e(f=>{d(f),m.onImageLoadingStatusChange(f)});return L(()=>{r!=="idle"&&i(r)},[r,i]),r==="loaded"?e.jsx(Y.img,{...a,ref:s,src:l}):null});pe.displayName=ge;var je="AvatarFallback",ye=u.forwardRef((t,s)=>{const{__scopeAvatar:n,delayMs:l,...d}=t,a=ve(je,n),[m,r]=u.useState(l===void 0);return u.useEffect(()=>{if(l!==void 0){const i=window.setTimeout(()=>r(!0),l);return()=>window.clearTimeout(i)}},[l]),m&&a.imageLoadingStatus!=="loaded"?e.jsx(Y.span,{...d,ref:s}):null});ye.displayName=je;function ne(t,s){return t?s?(t.src!==s&&(t.src=s),t.complete&&t.naturalWidth>0?"loaded":"loading"):"error":"idle"}function it(t,{referrerPolicy:s,crossOrigin:n}){const l=st(),d=u.useRef(null),a=l?(d.current||(d.current=new window.Image),d.current):null,[m,r]=u.useState(()=>ne(a,t));return L(()=>{r(ne(a,t))},[a,t]),L(()=>{const i=o=>()=>{r(o)};if(!a)return;const f=i("loaded"),g=i("error");return a.addEventListener("load",f),a.addEventListener("error",g),s&&(a.referrerPolicy=s),typeof n=="string"&&(a.crossOrigin=n),()=>{a.removeEventListener("load",f),a.removeEventListener("error",g)}},[a,n,s]),m}var Se=fe,be=pe,Ne=ye;const Ce=u.forwardRef(({className:t,...s},n)=>e.jsx(Se,{ref:n,className:H("relative flex h-10 w-10 shrink-0 overflow-hidden rounded-full",t),...s}));Ce.displayName=Se.displayName;const ke=u.forwardRef(({className:t,...s},n)=>e.jsx(be,{ref:n,className:H("aspect-square h-full w-full",t),...s}));ke.displayName=be.displayName;const Re=u.forwardRef(({className:t,...s},n)=>e.jsx(Ne,{ref:n,className:H("flex h-full w-full items-center justify-center rounded-full bg-muted text-sm font-medium",t),...s}));Re.displayName=Ne.displayName;function k(t){return`/tenants/${Te()}${t}`}function ot(t){return C.getPaged(k("/members"),t)}function lt(t){return C.delete(k(`/members/${t}`))}function ct(t){return C.getPaged(k("/invitations"),t)}function ut(t){return C.post(k("/invitations"),t)}function dt(t){return C.delete(k(`/invitations/${t}`))}function mt(t){return C.getPaged(k("/roles"),t)}function ht(t){return C.post(k("/roles/assign"),t)}function xt(t,s){return C.delete(k(`/roles/users/${t}/roles/${s}`))}const E="team-members",J="team-invitations",vt="team-roles";function ft(t){return G({queryKey:[E,t],queryFn:()=>ot(t)})}function gt(){const t=w();return A({mutationFn:s=>lt(s),onSuccess:()=>{t.invalidateQueries({queryKey:[E]})}})}function pt(){const t=w();return A({mutationFn:s=>ut(s),onSuccess:()=>{t.invalidateQueries({queryKey:[J]})}})}function jt(t){return G({queryKey:[J,t],queryFn:()=>ct(t)})}function yt(){const t=w();return A({mutationFn:s=>dt(s),onSuccess:()=>{t.invalidateQueries({queryKey:[J]})}})}function we(){return G({queryKey:[vt],queryFn:()=>mt({pageSize:100}),staleTime:300*1e3})}function St(){const t=w();return A({mutationFn:s=>ht(s),onSuccess:()=>{t.invalidateQueries({queryKey:[E]})}})}function bt(){const t=w();return A({mutationFn:({userId:s,roleId:n})=>xt(s,n),onSuccess:()=>{t.invalidateQueries({queryKey:[E]})}})}function Nt({open:t,onOpenChange:s}){const{t:n}=I("team"),[l,d]=u.useState(""),[a,m]=u.useState(""),r=pt(),{data:i}=we(),f=(i==null?void 0:i.items)??[],g=async o=>{o.preventDefault(),l.trim()&&(await r.mutateAsync({email:l.trim(),roleId:a||void 0}),d(""),m(""),s(!1))};return e.jsx(ae,{open:t,onOpenChange:s,children:e.jsx(re,{className:"sm:max-w-[425px]",children:e.jsxs("form",{onSubmit:g,children:[e.jsxs(ie,{children:[e.jsx(oe,{children:n("invite.title")}),e.jsx(le,{children:n("invite.description")})]}),e.jsxs("div",{className:"grid gap-4 py-4",children:[e.jsxs("div",{className:"grid gap-2",children:[e.jsx(T,{htmlFor:"email",children:n("invite.emailLabel")}),e.jsx(Oe,{id:"email",type:"email",placeholder:n("invite.emailPlaceholder"),value:l,onChange:o=>d(o.target.value),required:!0})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(T,{children:n("invite.roleLabel")}),e.jsxs(Ke,{value:a,onValueChange:m,children:[e.jsx(Be,{children:e.jsx(ze,{placeholder:n("invite.rolePlaceholder")})}),e.jsx(Ve,{children:f.map(o=>e.jsx(Ue,{value:o.id,children:o.name},o.id))})]})]})]}),e.jsxs(ce,{children:[e.jsx(N,{type:"button",variant:"outline",onClick:()=>s(!1),children:n("common:cancel")}),e.jsx(N,{type:"submit",disabled:r.isPending||!l.trim(),children:r.isPending?n("common:loading"):n("invite.submit")})]})]})})})}function Ct({open:t,onOpenChange:s,member:n}){const{t:l}=I("team"),{data:d}=we(),a=St(),m=bt(),[r,i]=u.useState(new Set),[f,g]=u.useState(!1),o=(d==null?void 0:d.items)??[],h=new Set((n==null?void 0:n.roles.map(c=>c.id))??[]);u.useEffect(()=>{n&&i(new Set(n.roles.map(c=>c.id)))},[n]);const p=c=>{i(y=>{const j=new Set(y);return j.has(c)?j.delete(c):j.add(c),j})},x=async()=>{if(n){g(!0);try{const c=[...r].filter(j=>!h.has(j)),y=[...h].filter(j=>!r.has(j));await Promise.all([...c.map(j=>a.mutateAsync({userId:n.userId,roleId:j})),...y.map(j=>m.mutateAsync({userId:n.userId,roleId:j}))]),s(!1)}finally{g(!1)}}};return e.jsx(ae,{open:t,onOpenChange:s,children:e.jsxs(re,{className:"sm:max-w-[425px]",children:[e.jsxs(ie,{children:[e.jsx(oe,{children:l("changeRole.title")}),e.jsx(le,{children:l("changeRole.description",{name:n==null?void 0:n.fullName})})]}),e.jsx("div",{className:"grid gap-3 py-4",children:o.map(c=>e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(Qe,{id:`role-${c.id}`,checked:r.has(c.id),onCheckedChange:()=>p(c.id)}),e.jsxs(T,{htmlFor:`role-${c.id}`,className:"flex-1 cursor-pointer",children:[e.jsx("span",{className:"font-medium",children:c.name}),c.description&&e.jsx("span",{className:"block text-xs text-muted-foreground",children:c.description})]})]},c.id))}),e.jsxs(ce,{children:[e.jsx(N,{variant:"outline",onClick:()=>s(!1),children:l("common:cancel")}),e.jsx(N,{onClick:x,disabled:f,children:l(f?"common:loading":"changeRole.save")})]})]})})}function kt({onInvite:t}){const{t:s}=I("team"),[n,l]=u.useState(1),[d,a]=u.useState(20),[m,r]=u.useState(null),{data:i,isLoading:f,refetch:g}=jt({page:n,pageSize:d}),o=yt(),h=async()=>{m&&(await o.mutateAsync(m.id),r(null))},p=[{key:"email",header:s("invitations.email"),cell:x=>e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Ge,{className:"h-4 w-4 text-muted-foreground"}),e.jsx("span",{className:"font-medium",children:x.email})]})},{key:"invitedByName",header:s("invitations.invitedBy")},{key:"status",header:s("invitations.status"),cell:x=>e.jsx(q,{variant:x.isExpired?"destructive":"warning",children:x.isExpired?s("invitations.expired"):s("invitations.pending")})},{key:"expiresAt",header:s("invitations.expires"),cell:x=>new Date(x.expiresAt).toLocaleDateString()},{key:"actions",header:s("invitations.actions"),className:"w-[70px]",cell:x=>e.jsxs(ue,{children:[e.jsx(de,{asChild:!0,children:e.jsx(N,{variant:"ghost",size:"icon",className:"h-8 w-8",children:e.jsx(me,{className:"h-4 w-4"})})}),e.jsx(he,{align:"end",children:e.jsxs(_,{className:"text-destructive",onClick:()=>r(x),children:[e.jsx(F,{className:"me-2 h-4 w-4"}),s("invitations.revoke")]})})]})}];return e.jsxs(e.Fragment,{children:[e.jsx(xe,{columns:p,data:(i==null?void 0:i.items)??[],isLoading:f,page:n,totalPages:i==null?void 0:i.totalPages,total:i==null?void 0:i.totalCount,pageSize:d,onPageChange:l,onPageSizeChange:a,onRefresh:()=>g(),emptyVariant:"team",emptyTitle:s("empty.invitations.title"),emptyDescription:s("empty.invitations.description"),emptyAction:e.jsx(N,{onClick:t,children:s("invite.title")}),actions:e.jsx(N,{onClick:t,children:s("invite.title")})}),e.jsx($,{open:!!m,onOpenChange:()=>r(null),children:e.jsxs(O,{children:[e.jsxs(K,{children:[e.jsx(B,{children:s("invitations.revoke")}),e.jsx(z,{children:s("invitations.confirmRevoke")})]}),e.jsxs(V,{children:[e.jsx(U,{children:s("common:cancel")}),e.jsx(Q,{onClick:h,className:"bg-destructive text-destructive-foreground hover:bg-destructive/90",children:s("invitations.revoke")})]})]})})]})}function Pt(){const{t}=I("team"),[s,n]=u.useState(""),[l,d]=u.useState(1),[a,m]=u.useState(20),[r,i]=u.useState([]),[f,g]=u.useState(!1),[o,h]=u.useState(null),[p,x]=u.useState(null),[c,y]=u.useState(!1),j=u.useMemo(()=>({page:l,pageSize:a,search:s||void 0}),[l,a,s]),{data:S,isLoading:Ae,refetch:Ie}=ft(j),X=gt(),Ee=async()=>{p&&(await X.mutateAsync(p.userId),x(null))},Pe=async()=>{const R=((S==null?void 0:S.items)??[]).filter(b=>r.includes(b.id));await Promise.all(R.map(b=>X.mutateAsync(b.userId))),i([]),y(!1)},Me=[{key:"name",header:t("members.name"),cell:v=>{var R,b;return e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs(Ce,{className:"h-8 w-8",children:[v.avatarUrl&&e.jsx(ke,{src:v.avatarUrl,alt:v.fullName}),e.jsxs(Re,{className:"text-xs",children:[((R=v.firstName)==null?void 0:R[0])??"",((b=v.lastName)==null?void 0:b[0])??""]})]}),e.jsxs("div",{className:"min-w-0",children:[e.jsx("p",{className:"font-medium truncate",children:v.fullName}),e.jsx("p",{className:"text-xs text-muted-foreground truncate",children:v.email})]})]})}},{key:"roles",header:t("members.roles"),cell:v=>{const R=v.isOwner?v.roles.filter(b=>b.name!=="Owner"):v.roles;return e.jsxs("div",{className:"flex flex-wrap gap-1",children:[v.isOwner&&e.jsx(q,{variant:"default",children:t("members.owner")}),R.map(b=>e.jsx(q,{variant:"secondary",children:b.name},b.id)),!v.isOwner&&R.length===0&&e.jsx("span",{className:"text-xs text-muted-foreground",children:t("members.noRoles")})]})}},{key:"joinedAt",header:t("members.joinedAt"),cell:v=>new Date(v.joinedAt).toLocaleDateString()},{key:"actions",header:t("members.actions"),className:"w-[70px]",cell:v=>e.jsxs(ue,{children:[e.jsx(de,{asChild:!0,children:e.jsx(N,{variant:"ghost",size:"icon",className:"h-8 w-8",children:e.jsx(me,{className:"h-4 w-4"})})}),e.jsxs(he,{align:"end",children:[e.jsxs(_,{onClick:()=>h(v),children:[e.jsx(He,{className:"me-2 h-4 w-4"}),t("members.changeRole")]}),!v.isOwner&&e.jsxs(e.Fragment,{children:[e.jsx(Ye,{}),e.jsxs(_,{className:"text-destructive",onClick:()=>x(v),children:[e.jsx(F,{className:"me-2 h-4 w-4"}),t("members.removeMember")]})]})]})]})}];return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold tracking-tight",children:t("title")}),e.jsx("p",{className:"text-muted-foreground",children:t("description")})]}),e.jsxs(_e,{defaultValue:"members",children:[e.jsxs(Fe,{children:[e.jsxs(Z,{value:"members",children:[e.jsx(qe,{className:"me-2 h-4 w-4"}),t("tabs.members")]}),e.jsxs(Z,{value:"invitations",children:[e.jsx(P,{className:"me-2 h-4 w-4"}),t("tabs.invitations")]})]}),e.jsx(ee,{value:"members",children:e.jsx(xe,{columns:Me,data:(S==null?void 0:S.items)??[],isLoading:Ae,selectable:!0,selectedIds:r,onSelectionChange:i,searchPlaceholder:t("members.searchPlaceholder"),searchValue:s,onSearchChange:v=>{n(v),d(1)},page:l,totalPages:S==null?void 0:S.totalPages,total:S==null?void 0:S.totalCount,pageSize:a,onPageChange:d,onPageSizeChange:m,onRefresh:()=>Ie(),emptyVariant:"team",emptyTitle:t("empty.members.title"),emptyDescription:t("empty.members.description"),emptyAction:e.jsxs(N,{onClick:()=>g(!0),children:[e.jsx(P,{className:"me-2 h-4 w-4"}),t("invite.title")]}),actions:e.jsxs(N,{onClick:()=>g(!0),children:[e.jsx(P,{className:"me-2 h-4 w-4"}),t("invite.title")]}),bulkActions:e.jsxs(N,{variant:"destructive",size:"sm",onClick:()=>y(!0),children:[e.jsx(F,{className:"me-2 h-4 w-4"}),t("members.removeSelected")]})})}),e.jsx(ee,{value:"invitations",children:e.jsx(kt,{onInvite:()=>g(!0)})})]}),e.jsx(Nt,{open:f,onOpenChange:g}),e.jsx(Ct,{open:!!o,onOpenChange:v=>!v&&h(null),member:o}),e.jsx($,{open:!!p,onOpenChange:()=>x(null),children:e.jsxs(O,{children:[e.jsxs(K,{children:[e.jsx(B,{children:t("members.removeMember")}),e.jsx(z,{children:t("members.confirmRemove")})]}),e.jsxs(V,{children:[e.jsx(U,{children:t("common:cancel")}),e.jsx(Q,{onClick:Ee,className:"bg-destructive text-destructive-foreground hover:bg-destructive/90",children:t("members.removeMember")})]})]})}),e.jsx($,{open:c,onOpenChange:y,children:e.jsxs(O,{children:[e.jsxs(K,{children:[e.jsx(B,{children:t("members.removeSelected")}),e.jsx(z,{children:t("members.confirmRemoveMultiple",{count:r.length})})]}),e.jsxs(V,{children:[e.jsx(U,{children:t("common:cancel")}),e.jsx(Q,{onClick:Pe,className:"bg-destructive text-destructive-foreground hover:bg-destructive/90",children:t("members.removeSelected")})]})]})})]})}export{Pt as TeamPage};
//# sourceMappingURL=index-CZ5T_XSb.js.map
