import{c as q,h as T,l as X,A as ye,q as ge,m as R,n as K,d as j,o as L,y,t as fe,T as ve,v as je,j as e,r as o,B as $,P as Se}from"./index-3LWobmh4.js";import{S as Ae,D as be}from"./DataTableAdvanced-BaepryHP.js";import{D as Ne,a as Ce,E as De,b as ke,c as I,k as Ee,T as Te,A as Pe,d as Fe,e as $e,f as qe,g as Me,h as _e,i as we,j as Ie}from"./alert-dialog-C58uG3WD.js";import{B as U,L as d}from"./label-C6xqjT5A.js";import{B as Ue}from"./ban-CAM-JbPt.js";import{C as Ke}from"./eye-CeiYeXqo.js";import{F as Le}from"./file-text-Y4nid_gy.js";import{B as Ve,D as Be}from"./download-8P9IEK_b.js";import{D as Z,a as J,b as ee,c as te,d as se,e as ae}from"./dialog-dlmPZOCs.js";import{S as B,b as W,c as Q,d as O,e as z,I as N}from"./select-DSHg5FKg.js";import{P as We}from"./pencil-DyyNSMRS.js";import{U as Qe}from"./upload-DY_JWs3d.js";/**
 * @license lucide-react v0.513.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Oe=[["path",{d:"M12 7v14",key:"1akyts"}],["path",{d:"M3 18a1 1 0 0 1-1-1V4a1 1 0 0 1 1-1h5a4 4 0 0 1 4 4 4 4 0 0 1 4-4h5a1 1 0 0 1 1 1v13a1 1 0 0 1-1 1h-6a3 3 0 0 0-3 3 3 3 0 0 0-3-3z",key:"ruj8y"}]],ze=q("book-open",Oe);/**
 * @license lucide-react v0.513.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Re=[["rect",{width:"20",height:"14",x:"2",y:"5",rx:"2",key:"ynyp8z"}],["line",{x1:"2",x2:"22",y1:"10",y2:"10",key:"1b3vmo"}]],He=q("credit-card",Re);/**
 * @license lucide-react v0.513.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ye=[["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z",key:"1rqfz7"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}]],Ge=q("file",Ye);/**
 * @license lucide-react v0.513.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Xe=[["path",{d:"m16 6-8.414 8.586a2 2 0 0 0 2.829 2.829l8.414-8.586a4 4 0 1 0-5.657-5.657l-8.379 8.551a6 6 0 1 0 8.485 8.485l8.379-8.551",key:"1miecu"}]],Ze=q("paperclip",Xe);/**
 * @license lucide-react v0.513.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Je=[["path",{d:"M17.8 19.2 16 11l3.5-3.5C21 6 21.5 4 21 3c-1-.5-3 0-4.5 1.5L13 8 4.8 6.2c-.5-.1-.9.1-1.1.5l-.3.5c-.2.5-.1 1 .3 1.3L9 12l-2 3H4l-1 1 3 2 2 3 1-1v-3l3-2 3.5 5.3c.3.4.8.5 1.3.3l.5-.2c.4-.3.6-.7.5-1.2z",key:"1v9wt8"}]],et=q("plane",Je);/**
 * @license lucide-react v0.513.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const tt=[["path",{d:"M11 2v2",key:"1539x4"}],["path",{d:"M5 2v2",key:"1yf1q8"}],["path",{d:"M5 3H4a2 2 0 0 0-2 2v4a6 6 0 0 0 12 0V5a2 2 0 0 0-2-2h-1",key:"rb5t3r"}],["path",{d:"M8 15a6 6 0 0 0 12 0v-3",key:"x18d4x"}],["circle",{cx:"20",cy:"10",r:"2",key:"ts1r5v"}]],st=q("stethoscope",tt);function P(a){return`/tenants/${X()}${a}`}function at(a,t){return T.getPaged(P(`/workers/${a}/documents`),t)}function nt(a,t){return T.get(P(`/workers/${a}/documents/${t}`))}function it(a,t){return T.post(P(`/workers/${a}/documents`),{...t,workerId:a})}function ct(a,t,r){return T.patch(P(`/workers/${a}/documents/${t}`),r)}function rt(a,t){return T.delete(P(`/workers/${a}/documents/${t}`))}async function ot(a,t,r){const s=ge(),c=X(),l=`${ye}/tenants/${c}/workers/${a}/documents/${t}/file`,m=new FormData;m.append("file",r);const h=await fetch(l,{method:"POST",headers:{...s?{Authorization:`Bearer ${s}`}:{},...c?{"X-Tenant-ID":c}:{}},body:m});if(!h.ok)throw new Error(`Failed to upload file: ${h.status}`);const p=await h.json();return p.data??p}function lt(a){return T.getPaged(P("/documents"),a)}function ut(){return T.get(P("/documents/compliance"))}const M="documents",_="workerDocuments",V="compliance";function dt(a,t){return R({queryKey:[_,a,t],queryFn:()=>at(a,t),enabled:!!a})}function mt(a){const t=K(),{t:r}=j("documents");return L({mutationFn:s=>it(a,s),onSuccess:()=>{t.invalidateQueries({queryKey:[_,a]}),t.invalidateQueries({queryKey:[M]}),t.invalidateQueries({queryKey:[V]}),y.success(r("toast.createSuccess"))},onError:s=>{y.error(s.message||r("toast.createError"))}})}function ht(a){const t=K(),{t:r}=j("documents");return L({mutationFn:({id:s,data:c})=>ct(a,s,c),onSuccess:()=>{t.invalidateQueries({queryKey:[_,a]}),t.invalidateQueries({queryKey:[M]}),t.invalidateQueries({queryKey:[V]}),y.success(r("toast.updateSuccess"))},onError:s=>{y.error(s.message||r("toast.updateError"))}})}function pt(a){const t=K(),{t:r}=j("documents");return L({mutationFn:s=>rt(a,s),onSuccess:()=>{t.invalidateQueries({queryKey:[_,a]}),t.invalidateQueries({queryKey:[M]}),t.invalidateQueries({queryKey:[V]}),y.success(r("toast.deleteSuccess"))},onError:s=>{y.error(s.message||r("toast.deleteError"))}})}function xt(a){const t=K(),{t:r}=j("documents");return L({mutationFn:({id:s,file:c})=>ot(a,s,c),onSuccess:()=>{t.invalidateQueries({queryKey:[_,a]}),t.invalidateQueries({queryKey:[M]}),y.success(r("toast.uploadSuccess"))},onError:s=>{y.error(s.message||r("toast.uploadError"))}})}function _t(a){return R({queryKey:[M,a],queryFn:()=>lt(a)})}function wt(){return R({queryKey:[V],queryFn:()=>ut()})}const yt={Valid:{variant:"success",icon:je},ExpiringSoon:{variant:"warning",icon:ve},Expired:{variant:"destructive",icon:fe},Pending:{variant:"secondary",icon:Ke},Revoked:{variant:"destructive",icon:Ue}},gt={Passport:{variant:"default",icon:ze},Visa:{variant:"default",icon:et},WorkPermit:{variant:"default",icon:Ve},MedicalCertificate:{variant:"default",icon:st},InsurancePolicy:{variant:"default",icon:Ae},EmiratesId:{variant:"default",icon:He},LabourCard:{variant:"default",icon:Le},Other:{variant:"outline",icon:Ge}},ne=["Passport","Visa","WorkPermit","MedicalCertificate","InsurancePolicy","EmiratesId","LabourCard","Other"],ie=["Pending","Valid","Expired","Revoked"],ft=["Pending","Valid","ExpiringSoon","Expired","Revoked"];function vt({status:a}){const{t}=j("documents"),r=yt[a];if(!r)return e.jsx(U,{variant:"outline",children:a});const s=r.icon;return e.jsxs(U,{variant:r.variant,children:[e.jsx(s,{className:"me-1 h-3 w-3"}),t(`effectiveStatus.${a}`)]})}function jt({type:a}){const{t}=j("documents"),r=gt[a];if(!r)return e.jsx(U,{variant:"outline",children:a});const s=r.icon;return e.jsxs(U,{variant:r.variant,children:[e.jsx(s,{className:"me-1 h-3 w-3"}),t(`documentType.${a}`)]})}function St({open:a,onOpenChange:t,workerId:r}){const{t:s}=j("documents"),c=mt(r),[l,m]=o.useState(""),[h,p]=o.useState(""),[C,g]=o.useState(""),[D,f]=o.useState(""),[k,E]=o.useState(""),[S,v]=o.useState(""),[A,b]=o.useState(""),x=()=>{m(""),p(""),g(""),f(""),E(""),v(""),b("")},F=async()=>{l&&(await c.mutateAsync({documentType:l,documentNumber:h||void 0,issuedAt:C||void 0,expiresAt:D||void 0,status:k||void 0,issuingAuthority:S||void 0,notes:A.trim()||void 0}),x(),t(!1))};return e.jsx(Z,{open:a,onOpenChange:i=>{i||x(),t(i)},children:e.jsxs(J,{children:[e.jsxs(ee,{children:[e.jsx(te,{children:s("create.title")}),e.jsx(se,{children:s("create.description")})]}),e.jsxs("div",{className:"space-y-4 py-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(d,{children:s("create.documentType")}),e.jsxs(B,{value:l,onValueChange:m,children:[e.jsx(W,{children:e.jsx(Q,{placeholder:s("create.documentTypePlaceholder")})}),e.jsx(O,{children:ne.map(i=>e.jsx(z,{value:i,children:s(`documentType.${i}`)},i))})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(d,{children:s("create.documentNumber")}),e.jsx(N,{value:h,onChange:i=>p(i.target.value),placeholder:s("create.documentNumberPlaceholder")})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(d,{children:s("create.issuedAt")}),e.jsx(N,{type:"date",value:C,onChange:i=>g(i.target.value)})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(d,{children:s("create.expiresAt")}),e.jsx(N,{type:"date",value:D,onChange:i=>f(i.target.value)})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(d,{children:s("create.status")}),e.jsxs(B,{value:k,onValueChange:E,children:[e.jsx(W,{children:e.jsx(Q,{placeholder:s("create.statusPlaceholder")})}),e.jsx(O,{children:ie.map(i=>e.jsx(z,{value:i,children:s(`status.${i}`)},i))})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(d,{children:s("create.issuingAuthority")}),e.jsx(N,{value:S,onChange:i=>v(i.target.value),placeholder:s("create.issuingAuthorityPlaceholder")})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(d,{children:s("create.notes")}),e.jsx("textarea",{className:"flex min-h-[60px] w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",placeholder:s("create.notesPlaceholder"),value:A,onChange:i=>b(i.target.value)})]})]}),e.jsxs(ae,{children:[e.jsx($,{variant:"outline",onClick:()=>{x(),t(!1)},children:s("common:cancel")}),e.jsx($,{onClick:F,disabled:!l||c.isPending,children:c.isPending?s("create.submitting"):s("create.submit")})]})]})})}function At({open:a,onOpenChange:t,workerId:r,document:s}){var x,F;const{t:c}=j("documents"),l=ht(r),[m,h]=o.useState(s.documentNumber??""),[p,C]=o.useState(((x=s.issuedAt)==null?void 0:x.slice(0,10))??""),[g,D]=o.useState(((F=s.expiresAt)==null?void 0:F.slice(0,10))??""),[f,k]=o.useState(s.status),[E,S]=o.useState(s.issuingAuthority??""),[v,A]=o.useState(s.notes??"");o.useEffect(()=>{var i,w;h(s.documentNumber??""),C(((i=s.issuedAt)==null?void 0:i.slice(0,10))??""),D(((w=s.expiresAt)==null?void 0:w.slice(0,10))??""),k(s.status),S(s.issuingAuthority??""),A(s.notes??"")},[s]);const b=async()=>{await l.mutateAsync({id:s.id,data:{documentNumber:m||void 0,issuedAt:p||void 0,expiresAt:g||void 0,status:f,issuingAuthority:E||void 0,notes:v.trim()||void 0}}),t(!1)};return e.jsx(Z,{open:a,onOpenChange:t,children:e.jsxs(J,{children:[e.jsxs(ee,{children:[e.jsx(te,{children:c("edit.title")}),e.jsxs(se,{children:[c(`documentType.${s.documentType}`),s.documentNumber?` - ${s.documentNumber}`:""]})]}),e.jsxs("div",{className:"space-y-4 py-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(d,{children:c("edit.documentNumber")}),e.jsx(N,{value:m,onChange:i=>h(i.target.value),placeholder:c("create.documentNumberPlaceholder")})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(d,{children:c("edit.issuedAt")}),e.jsx(N,{type:"date",value:p,onChange:i=>C(i.target.value)})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(d,{children:c("edit.expiresAt")}),e.jsx(N,{type:"date",value:g,onChange:i=>D(i.target.value)})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(d,{children:c("edit.status")}),e.jsxs(B,{value:f,onValueChange:i=>k(i),children:[e.jsx(W,{children:e.jsx(Q,{placeholder:c("create.statusPlaceholder")})}),e.jsx(O,{children:ie.map(i=>e.jsx(z,{value:i,children:c(`status.${i}`)},i))})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(d,{children:c("edit.issuingAuthority")}),e.jsx(N,{value:E,onChange:i=>S(i.target.value),placeholder:c("create.issuingAuthorityPlaceholder")})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(d,{children:c("edit.notes")}),e.jsx("textarea",{className:"flex min-h-[60px] w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",placeholder:c("create.notesPlaceholder"),value:v,onChange:i=>A(i.target.value)})]})]}),e.jsxs(ae,{children:[e.jsx($,{variant:"outline",onClick:()=>t(!1),children:c("common:cancel")}),e.jsx($,{onClick:b,disabled:l.isPending,children:l.isPending?c("edit.submitting"):c("edit.submit")})]})]})})}function It({workerId:a}){const{t}=j("documents"),[r,s]=o.useState(""),[c,l]=o.useState(1),[m,h]=o.useState(20),[p,C]=o.useState([]),[g,D]=o.useState(),[f,k]=o.useState(),[E,S]=o.useState(!1),[v,A]=o.useState(null),[b,x]=o.useState(null),F=o.useMemo(()=>({page:c,pageSize:m,search:r||void 0,sort:"-createdAt","filter[documentType]":g,"filter[effectiveStatus]":f}),[c,m,r,g,f]),{data:i,isLoading:w,refetch:ce}=dt(a,F),re=pt(a),oe=xt(a),le=async()=>{b&&(await re.mutateAsync(b.id),x(null))},ue=async n=>{const u=document.createElement("input");u.type="file",u.accept=".pdf,.jpg,.jpeg,.png,.doc,.docx",u.onchange=async xe=>{var G;const Y=(G=xe.target.files)==null?void 0:G[0];Y&&await oe.mutateAsync({id:n,file:Y})},u.click()},H=async n=>{try{const u=await nt(a,n);u.fileUrl?window.open(u.fileUrl,"_blank"):y.error(t("toast.noFile"))}catch{y.error(t("toast.downloadError"))}},de=[{key:"documentType",label:t("filters.documentType"),options:ne.map(n=>({label:t(`documentType.${n}`),value:n})),value:g},{key:"effectiveStatus",label:t("filters.status"),options:ft.map(n=>({label:t(`effectiveStatus.${n}`),value:n})),value:f}],me=(n,u)=>{n==="documentType"&&D(u),n==="effectiveStatus"&&k(u),l(1)},he=[{key:"documentType",header:t("columns.documentType"),cell:n=>e.jsx(jt,{type:n.documentType})},{key:"documentNumber",header:t("columns.documentNumber"),cell:n=>e.jsx("span",{className:"font-mono text-sm",children:n.documentNumber??"—"})},{key:"issuedAt",header:t("columns.issuedAt"),cell:n=>n.issuedAt?new Date(n.issuedAt).toLocaleDateString():"—"},{key:"expiresAt",header:t("columns.expiresAt"),cell:n=>n.expiresAt?new Date(n.expiresAt).toLocaleDateString():"—"},{key:"effectiveStatus",header:t("columns.status"),cell:n=>e.jsx(vt,{status:n.effectiveStatus})},{key:"daysUntilExpiry",header:t("columns.daysLeft"),cell:n=>{if(n.daysUntilExpiry==null)return"—";const u=n.daysUntilExpiry<0;return e.jsx("span",{className:u?"text-destructive font-medium":"",children:n.daysUntilExpiry})}},{key:"hasFile",header:t("columns.file"),className:"w-[60px]",cell:n=>n.hasFile?e.jsx("button",{onClick:()=>H(n.id),className:"inline-flex items-center text-primary hover:text-primary/80",title:t("actions.downloadFile"),children:e.jsx(Ze,{className:"h-4 w-4"})}):e.jsx("span",{className:"text-muted-foreground",children:"—"})},{key:"actions",header:t("columns.actions"),className:"w-[70px]",cell:n=>e.jsxs(Ne,{children:[e.jsx(Ce,{asChild:!0,children:e.jsx($,{variant:"ghost",size:"icon",className:"h-8 w-8",children:e.jsx(De,{className:"h-4 w-4"})})}),e.jsxs(ke,{align:"end",children:[e.jsxs(I,{onClick:()=>pe(n),children:[e.jsx(We,{className:"me-2 h-4 w-4"}),t("actions.edit")]}),e.jsxs(I,{onClick:()=>ue(n.id),children:[e.jsx(Qe,{className:"me-2 h-4 w-4"}),t("actions.uploadFile")]}),n.hasFile&&e.jsxs(I,{onClick:()=>H(n.id),children:[e.jsx(Be,{className:"me-2 h-4 w-4"}),t("actions.downloadFile")]}),e.jsx(Ee,{}),e.jsxs(I,{className:"text-destructive",onClick:()=>x(n),children:[e.jsx(Te,{className:"me-2 h-4 w-4"}),t("actions.delete")]})]})]})}],pe=async n=>{const u={id:n.id,tenantId:"",workerId:n.workerId,documentType:n.documentType,documentNumber:n.documentNumber,issuedAt:n.issuedAt,expiresAt:n.expiresAt,status:n.status,effectiveStatus:n.effectiveStatus,daysUntilExpiry:n.daysUntilExpiry,hasFile:n.hasFile,createdAt:n.createdAt,updatedAt:n.createdAt};A(u)};return e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"flex items-center justify-end",children:e.jsxs($,{onClick:()=>S(!0),children:[e.jsx(Se,{className:"me-2 h-4 w-4"}),t("addDocument")]})}),e.jsx(be,{columns:he,data:(i==null?void 0:i.items)??[],isLoading:w,selectable:!0,selectedIds:p,onSelectionChange:C,searchPlaceholder:t("searchPlaceholder"),searchValue:r,onSearchChange:n=>{s(n),l(1)},filters:de,onFilterChange:me,page:c,totalPages:i==null?void 0:i.totalPages,total:i==null?void 0:i.totalCount,pageSize:m,onPageChange:l,onPageSizeChange:h,onRefresh:()=>ce(),emptyVariant:"default",emptyTitle:t("empty.title"),emptyDescription:t("empty.description")}),e.jsx(St,{open:E,onOpenChange:S,workerId:a}),v&&e.jsx(At,{open:!!v,onOpenChange:n=>{n||A(null)},workerId:a,document:v}),e.jsx(Pe,{open:!!b,onOpenChange:()=>x(null),children:e.jsxs(Fe,{children:[e.jsxs($e,{children:[e.jsx(qe,{children:t("deleteDialog.title")}),e.jsx(Me,{children:t("deleteDialog.description")})]}),e.jsxs(_e,{children:[e.jsx(we,{children:t("common:cancel")}),e.jsx(Ie,{onClick:le,className:"bg-destructive text-destructive-foreground hover:bg-destructive/90",children:t("deleteDialog.confirm")})]})]})})]})}export{ne as A,ze as B,jt as D,et as P,st as S,It as W,_t as a,ft as b,vt as c,Ze as d,nt as g,wt as u};
//# sourceMappingURL=WorkerDocumentsTab-Bd4WGVx-.js.map
