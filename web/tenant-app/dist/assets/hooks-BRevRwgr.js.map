{"version":3,"file":"hooks-BRevRwgr.js","sources":["../../src/features/workers/api.ts","../../src/features/workers/hooks.ts"],"sourcesContent":["import { apiClient, API_BASE } from '@/shared/api/client';\nimport { getTenantId, getAccessToken } from '@/features/auth/AuthProvider';\nimport type { QueryParams } from '@/shared/api/types/common';\nimport type {\n  WorkerDto,\n  WorkerListDto,\n  WorkerStatusHistoryDto,\n  UpdateWorkerRequest,\n  TransitionWorkerStatusRequest,\n  WorkerCvDto,\n} from './types';\n\nfunction tenantPath(path: string) {\n  const tenantId = getTenantId();\n  return `/tenants/${tenantId}${path}`;\n}\n\nexport function listWorkers(params?: QueryParams) {\n  return apiClient.getPaged<WorkerListDto>(tenantPath('/workers'), params);\n}\n\nexport function getWorker(id: string, params?: QueryParams) {\n  return apiClient.get<WorkerDto>(tenantPath(`/workers/${id}`), params);\n}\n\nexport function updateWorker(id: string, data: UpdateWorkerRequest) {\n  return apiClient.patch<WorkerDto>(tenantPath(`/workers/${id}`), data);\n}\n\nexport function transitionWorkerStatus(id: string, data: TransitionWorkerStatusRequest) {\n  return apiClient.post<WorkerDto>(tenantPath(`/workers/${id}/status`), data);\n}\n\nexport function getWorkerStatusHistory(id: string) {\n  return apiClient.get<WorkerStatusHistoryDto[]>(tenantPath(`/workers/${id}/status-history`));\n}\n\nexport function getWorkerCv(id: string) {\n  return apiClient.get<WorkerCvDto>(tenantPath(`/workers/${id}/cv`));\n}\n\nexport function deleteWorker(id: string) {\n  return apiClient.delete<void>(tenantPath(`/workers/${id}`));\n}\n\nexport async function downloadWorkerCvPdf(id: string): Promise<Blob> {\n  const token = getAccessToken();\n  const tenantId = getTenantId();\n  const url = `${API_BASE}/tenants/${tenantId}/workers/${id}/cv/pdf`;\n\n  const response = await fetch(url, {\n    method: 'GET',\n    headers: {\n      ...(token ? { Authorization: `Bearer ${token}` } : {}),\n      ...(tenantId ? { 'X-Tenant-ID': tenantId } : {}),\n    },\n  });\n\n  if (!response.ok) {\n    throw new Error(`Failed to download PDF: ${response.status}`);\n  }\n\n  return response.blob();\n}\n","import { useQuery, useMutation, useQueryClient } from '@tanstack/react-query';\nimport type { QueryParams } from '@/shared/api/types/common';\nimport * as api from './api';\nimport type {\n  UpdateWorkerRequest,\n  TransitionWorkerStatusRequest,\n} from './types';\n\nconst WORKERS_KEY = 'workers';\n\nexport function useWorkers(params?: QueryParams) {\n  return useQuery({\n    queryKey: [WORKERS_KEY, params],\n    queryFn: () => api.listWorkers({ ...params, include: 'supplier' }),\n  });\n}\n\nexport function useWorker(id: string) {\n  return useQuery({\n    queryKey: [WORKERS_KEY, id],\n    queryFn: () => api.getWorker(id, { include: 'statusHistory,supplier' }),\n    enabled: !!id,\n  });\n}\n\nexport function useWorkerStatusHistory(id: string) {\n  return useQuery({\n    queryKey: [WORKERS_KEY, id, 'status-history'],\n    queryFn: () => api.getWorkerStatusHistory(id),\n    enabled: !!id,\n  });\n}\n\nexport function useUpdateWorker() {\n  const queryClient = useQueryClient();\n  return useMutation({\n    mutationFn: ({ id, data }: { id: string; data: UpdateWorkerRequest }) =>\n      api.updateWorker(id, data),\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [WORKERS_KEY] });\n    },\n  });\n}\n\nexport function useTransitionWorkerStatus() {\n  const queryClient = useQueryClient();\n  return useMutation({\n    mutationFn: ({ id, data }: { id: string; data: TransitionWorkerStatusRequest }) =>\n      api.transitionWorkerStatus(id, data),\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [WORKERS_KEY] });\n    },\n  });\n}\n\nexport function useDeleteWorker() {\n  const queryClient = useQueryClient();\n  return useMutation({\n    mutationFn: (id: string) => api.deleteWorker(id),\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [WORKERS_KEY] });\n    },\n  });\n}\n"],"names":["tenantPath","path","getTenantId","listWorkers","params","apiClient","getWorker","id","updateWorker","data","transitionWorkerStatus","getWorkerCv","deleteWorker","downloadWorkerCvPdf","token","getAccessToken","tenantId","url","API_BASE","response","WORKERS_KEY","useWorkers","useQuery","api.listWorkers","useWorker","api.getWorker","useUpdateWorker","queryClient","useQueryClient","useMutation","api.updateWorker","useTransitionWorkerStatus","api.transitionWorkerStatus","useDeleteWorker","api.deleteWorker"],"mappings":"kFAYA,SAASA,EAAWC,EAAc,CAEhC,MAAO,YADUC,EAAA,CACU,GAAGD,CAAI,EACpC,CAEO,SAASE,EAAYC,EAAsB,CAChD,OAAOC,EAAU,SAAwBL,EAAW,UAAU,EAAGI,CAAM,CACzE,CAEO,SAASE,EAAUC,EAAYH,EAAsB,CAC1D,OAAOC,EAAU,IAAeL,EAAW,YAAYO,CAAE,EAAE,EAAGH,CAAM,CACtE,CAEO,SAASI,EAAaD,EAAYE,EAA2B,CAClE,OAAOJ,EAAU,MAAiBL,EAAW,YAAYO,CAAE,EAAE,EAAGE,CAAI,CACtE,CAEO,SAASC,EAAuBH,EAAYE,EAAqC,CACtF,OAAOJ,EAAU,KAAgBL,EAAW,YAAYO,CAAE,SAAS,EAAGE,CAAI,CAC5E,CAMO,SAASE,EAAYJ,EAAY,CACtC,OAAOF,EAAU,IAAiBL,EAAW,YAAYO,CAAE,KAAK,CAAC,CACnE,CAEO,SAASK,EAAaL,EAAY,CACvC,OAAOF,EAAU,OAAaL,EAAW,YAAYO,CAAE,EAAE,CAAC,CAC5D,CAEA,eAAsBM,EAAoBN,EAA2B,CACnE,MAAMO,EAAQC,EAAA,EACRC,EAAWd,EAAA,EACXe,EAAM,GAAGC,CAAQ,YAAYF,CAAQ,YAAYT,CAAE,UAEnDY,EAAW,MAAM,MAAMF,EAAK,CAChC,OAAQ,MACR,QAAS,CACP,GAAIH,EAAQ,CAAE,cAAe,UAAUA,CAAK,EAAA,EAAO,CAAA,EACnD,GAAIE,EAAW,CAAE,cAAeA,GAAa,CAAA,CAAC,CAChD,CACD,EAED,GAAI,CAACG,EAAS,GACZ,MAAM,IAAI,MAAM,2BAA2BA,EAAS,MAAM,EAAE,EAG9D,OAAOA,EAAS,KAAA,CAClB,CCvDA,MAAMC,EAAc,UAEb,SAASC,EAAWjB,EAAsB,CAC/C,OAAOkB,EAAS,CACd,SAAU,CAACF,EAAahB,CAAM,EAC9B,QAAS,IAAMmB,EAAgB,CAAE,GAAGnB,EAAQ,QAAS,UAAA,CAAY,CAAA,CAClE,CACH,CAEO,SAASoB,EAAUjB,EAAY,CACpC,OAAOe,EAAS,CACd,SAAU,CAACF,EAAab,CAAE,EAC1B,QAAS,IAAMkB,EAAclB,EAAI,CAAE,QAAS,yBAA0B,EACtE,QAAS,CAAC,CAACA,CAAA,CACZ,CACH,CAUO,SAASmB,GAAkB,CAChC,MAAMC,EAAcC,EAAA,EACpB,OAAOC,EAAY,CACjB,WAAY,CAAC,CAAE,GAAAtB,EAAI,KAAAE,KACjBqB,EAAiBvB,EAAIE,CAAI,EAC3B,UAAW,IAAM,CACfkB,EAAY,kBAAkB,CAAE,SAAU,CAACP,CAAW,EAAG,CAC3D,CAAA,CACD,CACH,CAEO,SAASW,GAA4B,CAC1C,MAAMJ,EAAcC,EAAA,EACpB,OAAOC,EAAY,CACjB,WAAY,CAAC,CAAE,GAAAtB,EAAI,KAAAE,KACjBuB,EAA2BzB,EAAIE,CAAI,EACrC,UAAW,IAAM,CACfkB,EAAY,kBAAkB,CAAE,SAAU,CAACP,CAAW,EAAG,CAC3D,CAAA,CACD,CACH,CAEO,SAASa,GAAkB,CAChC,MAAMN,EAAcC,EAAA,EACpB,OAAOC,EAAY,CACjB,WAAatB,GAAe2B,EAAiB3B,CAAE,EAC/C,UAAW,IAAM,CACfoB,EAAY,kBAAkB,CAAE,SAAU,CAACP,CAAW,EAAG,CAC3D,CAAA,CACD,CACH"}