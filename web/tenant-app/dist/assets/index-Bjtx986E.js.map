{"version":3,"file":"index-Bjtx986E.js","sources":["../../src/features/audit/api.ts","../../src/features/audit/hooks.ts","../../src/features/audit/pages/AuditPage.tsx"],"sourcesContent":["import { apiClient } from '@/shared/api/client';\nimport { getTenantId } from '@/features/auth/AuthProvider';\nimport type { QueryParams } from '@/shared/api/types/common';\nimport type { AuditEventDto, AuditLogDto } from './types';\n\nfunction tenantPath(path: string) {\n  const tenantId = getTenantId();\n  return `/tenants/${tenantId}${path}`;\n}\n\nexport function listAuditEvents(params?: QueryParams) {\n  return apiClient.getPaged<AuditEventDto>(tenantPath('/audit/events'), params);\n}\n\nexport function listAuditLogs(params?: QueryParams) {\n  return apiClient.getPaged<AuditLogDto>(tenantPath('/audit/logs'), params);\n}\n","import { useQuery } from '@tanstack/react-query';\nimport type { QueryParams } from '@/shared/api/types/common';\nimport * as api from './api';\n\nconst AUDIT_KEY = 'audit';\n\nexport function useAuditEvents(params?: QueryParams) {\n  return useQuery({\n    queryKey: [AUDIT_KEY, 'events', params],\n    queryFn: () => api.listAuditEvents(params),\n  });\n}\n\nexport function useAuditLogs(params?: QueryParams) {\n  return useQuery({\n    queryKey: [AUDIT_KEY, 'logs', params],\n    queryFn: () => api.listAuditLogs(params),\n  });\n}\n","import { useState, useMemo } from \"react\";\nimport { useTranslation } from \"react-i18next\";\nimport { ClipboardList, ChevronDown, ChevronRight } from \"lucide-react\";\nimport { DataTableAdvanced } from \"@/shared/components/data-table\";\nimport type { Column } from \"@/shared/components/data-table/DataTableAdvanced\";\nimport { useAuditEvents } from \"../hooks\";\nimport type { AuditEventDto } from \"../types\";\n\nfunction JsonPreview({ json }: { json: string | null }) {\n  const [expanded, setExpanded] = useState(false);\n  if (!json) return <span className=\"text-muted-foreground text-xs\">-</span>;\n\n  let parsed: unknown;\n  try {\n    parsed = JSON.parse(json);\n  } catch {\n    return <span className=\"text-xs text-muted-foreground\">{json}</span>;\n  }\n\n  const formatted = JSON.stringify(parsed, null, 2);\n  const preview = JSON.stringify(parsed).slice(0, 60);\n\n  return (\n    <div>\n      <button\n        onClick={() => setExpanded(!expanded)}\n        className=\"flex items-center gap-1 text-xs text-muted-foreground hover:text-foreground\"\n      >\n        {expanded ? <ChevronDown className=\"h-3 w-3\" /> : <ChevronRight className=\"h-3 w-3\" />}\n        <span className=\"font-mono\">{expanded ? \"collapse\" : preview + (preview.length >= 60 ? \"...\" : \"\")}</span>\n      </button>\n      {expanded && (\n        <pre className=\"mt-1 max-h-48 overflow-auto rounded bg-muted p-2 text-xs font-mono\">\n          {formatted}\n        </pre>\n      )}\n    </div>\n  );\n}\n\nfunction formatTime(iso: string) {\n  return new Date(iso).toLocaleString();\n}\n\nfunction formatUserId(userId: string | null) {\n  if (!userId) return <span className=\"text-muted-foreground\">-</span>;\n  return <span className=\"font-mono text-xs\">{userId.slice(0, 8)}...</span>;\n}\n\nexport function AuditPage() {\n  const { t } = useTranslation(\"audit\");\n  const [page, setPage] = useState(1);\n  const [pageSize, setPageSize] = useState(20);\n  const [search, setSearch] = useState(\"\");\n\n  const params = useMemo(() => ({\n    page,\n    pageSize,\n    sort: \"-createdAt\",\n    ...(search ? { filter: { name: search } } : {}),\n  }), [page, pageSize, search]);\n\n  const { data, isLoading, refetch } = useAuditEvents(params);\n\n  const columns: Column<AuditEventDto>[] = [\n    { key: \"eventName\", header: t(\"events.eventName\"), cell: (row) => <span className=\"font-medium\">{row.eventName}</span> },\n    { key: \"userId\", header: t(\"events.userId\"), cell: (row) => formatUserId(row.userId) },\n    { key: \"createdAt\", header: t(\"events.time\"), cell: (row) => <span className=\"text-sm\">{formatTime(row.createdAt)}</span> },\n    { key: \"payload\", header: t(\"events.payload\"), cell: (row) => <JsonPreview json={row.payload} /> },\n  ];\n\n  return (\n    <div className=\"space-y-6\">\n      <div>\n        <h1 className=\"text-2xl font-bold tracking-tight\">{t(\"title\")}</h1>\n        <p className=\"text-muted-foreground\">{t(\"description\")}</p>\n      </div>\n\n      <DataTableAdvanced<AuditEventDto>\n        columns={columns}\n        data={data?.items ?? []}\n        isLoading={isLoading}\n        searchPlaceholder={t(\"filters.eventName\")}\n        searchValue={search}\n        onSearchChange={setSearch}\n        page={page}\n        pageSize={pageSize}\n        totalPages={data?.totalPages ?? 0}\n        total={data?.totalCount ?? 0}\n        onPageChange={setPage}\n        onPageSizeChange={setPageSize}\n        onRefresh={() => refetch()}\n        emptyIcon={ClipboardList}\n        emptyTitle={t(\"empty.events.title\")}\n        emptyDescription={t(\"empty.events.description\")}\n      />\n    </div>\n  );\n}\n"],"names":["tenantPath","path","getTenantId","listAuditEvents","params","apiClient","AUDIT_KEY","useAuditEvents","useQuery","api.listAuditEvents","JsonPreview","json","expanded","setExpanded","useState","parsed","jsx","formatted","preview","jsxs","ChevronDown","ChevronRight","formatTime","iso","formatUserId","userId","AuditPage","t","useTranslation","page","setPage","pageSize","setPageSize","search","setSearch","useMemo","data","isLoading","refetch","columns","row","DataTableAdvanced","ClipboardList"],"mappings":"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"}