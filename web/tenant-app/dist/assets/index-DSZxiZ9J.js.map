{"version":3,"file":"index-DSZxiZ9J.js","sources":["../../src/features/documents/pages/CompliancePage.tsx"],"sourcesContent":["import { useState, useMemo } from 'react';\nimport { useNavigate } from 'react-router-dom';\nimport { useTranslation } from 'react-i18next';\nimport { toast } from 'sonner';\nimport { DataTableAdvanced, type Column, type Filter } from '@/shared/components/data-table/DataTableAdvanced';\nimport { Card, CardContent, CardHeader, CardTitle } from '@/shared/components/ui/card';\nimport { Skeleton } from '@/shared/components/ui/skeleton';\nimport { Button } from '@/shared/components/ui/button';\nimport {\n  DropdownMenu,\n  DropdownMenuContent,\n  DropdownMenuItem,\n  DropdownMenuTrigger,\n} from '@/shared/components/ui/dropdown-menu';\nimport {\n  FileText, CheckCircle, AlertTriangle, XCircle,\n  MoreHorizontal, Eye, Download, Paperclip,\n} from 'lucide-react';\nimport { useAllDocuments, useComplianceSummary } from '../hooks';\nimport { getWorkerDocument } from '../api';\nimport { DocumentStatusBadge } from '../components/DocumentStatusBadge';\nimport { DocumentTypeBadge } from '../components/DocumentTypeBadge';\nimport { ALL_DOCUMENT_TYPES, ALL_EFFECTIVE_STATUSES } from '../constants';\nimport type { WorkerDocumentListDto } from '../types';\n\nfunction SummaryCard({\n  title,\n  value,\n  icon: Icon,\n  className,\n  isLoading,\n}: {\n  title: string;\n  value: number;\n  icon: React.ElementType;\n  className?: string;\n  isLoading?: boolean;\n}) {\n  return (\n    <Card>\n      <CardHeader className=\"flex flex-row items-center justify-between space-y-0 pb-2\">\n        <CardTitle className=\"text-sm font-medium\">{title}</CardTitle>\n        <Icon className={`h-4 w-4 ${className ?? 'text-muted-foreground'}`} />\n      </CardHeader>\n      <CardContent>\n        {isLoading ? (\n          <Skeleton className=\"h-8 w-16\" />\n        ) : (\n          <div className={`text-2xl font-bold ${className ?? ''}`}>{value}</div>\n        )}\n      </CardContent>\n    </Card>\n  );\n}\n\nexport function CompliancePage() {\n  const { t } = useTranslation('documents');\n  const navigate = useNavigate();\n\n  // Table state\n  const [search, setSearch] = useState('');\n  const [page, setPage] = useState(1);\n  const [pageSize, setPageSize] = useState(20);\n  const [selectedIds, setSelectedIds] = useState<string[]>([]);\n  const [typeFilter, setTypeFilter] = useState<string | undefined>();\n  const [statusFilter, setStatusFilter] = useState<string | undefined>();\n\n  // Data\n  const { data: compliance, isLoading: complianceLoading } = useComplianceSummary();\n\n  const queryParams = useMemo(() => ({\n    page,\n    pageSize,\n    search: search || undefined,\n    sort: 'expiresAt',\n    'filter[documentType]': typeFilter,\n    'filter[effectiveStatus]': statusFilter,\n  }), [page, pageSize, search, typeFilter, statusFilter]);\n\n  const { data, isLoading, refetch } = useAllDocuments(queryParams);\n\n  const handleDownloadFile = async (workerId: string, docId: string) => {\n    try {\n      const doc = await getWorkerDocument(workerId, docId);\n      if (doc.fileUrl) {\n        window.open(doc.fileUrl, '_blank');\n      } else {\n        toast.error(t('toast.noFile'));\n      }\n    } catch {\n      toast.error(t('toast.downloadError'));\n    }\n  };\n\n  const filters: Filter[] = [\n    {\n      key: 'documentType',\n      label: t('filters.documentType'),\n      options: ALL_DOCUMENT_TYPES.map((dt) => ({ label: t(`documentType.${dt}`), value: dt })),\n      value: typeFilter,\n    },\n    {\n      key: 'effectiveStatus',\n      label: t('filters.status'),\n      options: ALL_EFFECTIVE_STATUSES.map((s) => ({ label: t(`effectiveStatus.${s}`), value: s })),\n      value: statusFilter,\n    },\n  ];\n\n  const handleFilterChange = (key: string, value: string | undefined) => {\n    if (key === 'documentType') setTypeFilter(value);\n    if (key === 'effectiveStatus') setStatusFilter(value);\n    setPage(1);\n  };\n\n  const columns: Column<WorkerDocumentListDto>[] = [\n    {\n      key: 'worker',\n      header: t('columns.worker'),\n      cell: (row) => (\n        <div className=\"min-w-0\">\n          <p className=\"font-medium truncate\">{row.workerName ?? '—'}</p>\n          {row.workerCode && (\n            <p className=\"text-xs text-muted-foreground font-mono\">{row.workerCode}</p>\n          )}\n        </div>\n      ),\n    },\n    {\n      key: 'documentType',\n      header: t('columns.documentType'),\n      cell: (row) => <DocumentTypeBadge type={row.documentType} />,\n    },\n    {\n      key: 'documentNumber',\n      header: t('columns.documentNumber'),\n      cell: (row) => (\n        <span className=\"font-mono text-sm\">{row.documentNumber ?? '—'}</span>\n      ),\n    },\n    {\n      key: 'expiresAt',\n      header: t('columns.expiresAt'),\n      cell: (row) => row.expiresAt ? new Date(row.expiresAt).toLocaleDateString() : '—',\n    },\n    {\n      key: 'effectiveStatus',\n      header: t('columns.status'),\n      cell: (row) => <DocumentStatusBadge status={row.effectiveStatus} />,\n    },\n    {\n      key: 'daysUntilExpiry',\n      header: t('columns.daysLeft'),\n      cell: (row) => {\n        if (row.daysUntilExpiry == null) return '—';\n        const isNegative = row.daysUntilExpiry < 0;\n        return (\n          <span className={isNegative ? 'text-destructive font-medium' : ''}>\n            {row.daysUntilExpiry}\n          </span>\n        );\n      },\n    },\n    {\n      key: 'hasFile',\n      header: t('columns.file'),\n      className: 'w-[60px]',\n      cell: (row) => row.hasFile ? (\n        <button\n          onClick={() => handleDownloadFile(row.workerId, row.id)}\n          className=\"inline-flex items-center text-primary hover:text-primary/80\"\n          title={t('actions.downloadFile')}\n        >\n          <Paperclip className=\"h-4 w-4\" />\n        </button>\n      ) : (\n        <span className=\"text-muted-foreground\">—</span>\n      ),\n    },\n    {\n      key: 'actions',\n      header: t('columns.actions'),\n      className: 'w-[70px]',\n      cell: (row) => (\n        <DropdownMenu>\n          <DropdownMenuTrigger asChild>\n            <Button variant=\"ghost\" size=\"icon\" className=\"h-8 w-8\">\n              <MoreHorizontal className=\"h-4 w-4\" />\n            </Button>\n          </DropdownMenuTrigger>\n          <DropdownMenuContent align=\"end\">\n            <DropdownMenuItem onClick={() => navigate(`/workers/${row.workerId}`)}>\n              <Eye className=\"me-2 h-4 w-4\" />\n              {t('actions.viewWorker')}\n            </DropdownMenuItem>\n            {row.hasFile && (\n              <DropdownMenuItem onClick={() => handleDownloadFile(row.workerId, row.id)}>\n                <Download className=\"me-2 h-4 w-4\" />\n                {t('actions.downloadFile')}\n              </DropdownMenuItem>\n            )}\n          </DropdownMenuContent>\n        </DropdownMenu>\n      ),\n    },\n  ];\n\n  return (\n    <div className=\"space-y-6\">\n      <div>\n        <h1 className=\"text-2xl font-bold tracking-tight\">{t('compliance.title')}</h1>\n        <p className=\"text-muted-foreground\">{t('compliance.description')}</p>\n      </div>\n\n      {/* Summary Cards */}\n      <div className=\"grid gap-4 md:grid-cols-4\">\n        <SummaryCard\n          title={t('compliance.totalDocuments')}\n          value={compliance?.totalDocuments ?? 0}\n          icon={FileText}\n          isLoading={complianceLoading}\n        />\n        <SummaryCard\n          title={t('compliance.valid')}\n          value={compliance?.valid ?? 0}\n          icon={CheckCircle}\n          className=\"text-emerald-600\"\n          isLoading={complianceLoading}\n        />\n        <SummaryCard\n          title={t('compliance.expiringSoon')}\n          value={compliance?.expiringSoon ?? 0}\n          icon={AlertTriangle}\n          className=\"text-amber-600\"\n          isLoading={complianceLoading}\n        />\n        <SummaryCard\n          title={t('compliance.expired')}\n          value={compliance?.expired ?? 0}\n          icon={XCircle}\n          className=\"text-destructive\"\n          isLoading={complianceLoading}\n        />\n      </div>\n\n      {/* All Documents Table */}\n      <DataTableAdvanced\n        columns={columns}\n        data={data?.items ?? []}\n        isLoading={isLoading}\n        selectable\n        selectedIds={selectedIds}\n        onSelectionChange={setSelectedIds}\n        searchPlaceholder={t('compliance.searchPlaceholder')}\n        searchValue={search}\n        onSearchChange={(val) => {\n          setSearch(val);\n          setPage(1);\n        }}\n        filters={filters}\n        onFilterChange={handleFilterChange}\n        page={page}\n        totalPages={data?.totalPages}\n        total={data?.totalCount}\n        pageSize={pageSize}\n        onPageChange={setPage}\n        onPageSizeChange={setPageSize}\n        onRefresh={() => refetch()}\n        emptyVariant=\"default\"\n        emptyTitle={t('compliance.empty.title')}\n        emptyDescription={t('compliance.empty.description')}\n      />\n    </div>\n  );\n}\n"],"names":["SummaryCard","title","value","Icon","className","isLoading","Card","jsxs","CardHeader","jsx","CardTitle","CardContent","Skeleton","CompliancePage","t","useTranslation","navigate","useNavigate","search","setSearch","useState","page","setPage","pageSize","setPageSize","selectedIds","setSelectedIds","typeFilter","setTypeFilter","statusFilter","setStatusFilter","compliance","complianceLoading","useComplianceSummary","queryParams","useMemo","data","refetch","useAllDocuments","handleDownloadFile","workerId","docId","doc","getWorkerDocument","toast","filters","ALL_DOCUMENT_TYPES","dt","ALL_EFFECTIVE_STATUSES","s","handleFilterChange","key","columns","row","DocumentTypeBadge","DocumentStatusBadge","isNegative","Paperclip","DropdownMenu","DropdownMenuTrigger","Button","MoreHorizontal","DropdownMenuContent","DropdownMenuItem","Eye","Download","FileText","CheckCircle","AlertTriangle","XCircle","DataTableAdvanced","val"],"mappings":"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"}